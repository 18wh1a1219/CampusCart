92f1c9635836e80d61a453198447a622
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

function _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.filterConfig = filterConfig;
exports.findNodeHandle = findNodeHandle;
exports.baseGestureHandlerWithMonitorProps = exports.baseGestureHandlerProps = void 0;

var _reactNative = require("react-native");

var _handlersRegistry = require("./handlersRegistry");

var _utils = require("../utils");

var commonProps = ['id', 'enabled', 'shouldCancelWhenOutside', 'hitSlop'];
var componentInteractionProps = ['waitFor', 'simultaneousHandlers'];
var baseGestureHandlerProps = [].concat(commonProps, componentInteractionProps, ['onBegan', 'onFailed', 'onCancelled', 'onActivated', 'onEnded', 'onGestureEvent', 'onHandlerStateChange']);
exports.baseGestureHandlerProps = baseGestureHandlerProps;
var baseGestureHandlerWithMonitorProps = [].concat(commonProps, ['needsPointerData', 'manualActivation']);
exports.baseGestureHandlerWithMonitorProps = baseGestureHandlerWithMonitorProps;

function isConfigParam(param, name) {
  return param !== undefined && (param !== Object(param) || !('__isNative' in param)) && name !== 'onHandlerStateChange' && name !== 'onGestureEvent';
}

function filterConfig(props, validProps) {
  var defaults = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var filteredConfig = (0, _extends2.default)({}, defaults);

  for (var _iterator = _createForOfIteratorHelperLoose(validProps), _step; !(_step = _iterator()).done;) {
    var key = _step.value;
    var value = props[key];

    if (isConfigParam(value, key)) {
      if (key === 'simultaneousHandlers' || key === 'waitFor') {
        value = transformIntoHandlerTags(props[key]);
      } else if (key === 'hitSlop' && typeof value !== 'object') {
        value = {
          top: value,
          left: value,
          bottom: value,
          right: value
        };
      }

      filteredConfig[key] = value;
    }
  }

  return filteredConfig;
}

function transformIntoHandlerTags(handlerIDs) {
  handlerIDs = (0, _utils.toArray)(handlerIDs);

  if (_reactNative.Platform.OS === 'web') {
    return handlerIDs.map(function (_ref) {
      var current = _ref.current;
      return current;
    }).filter(function (handle) {
      return handle;
    });
  }

  return handlerIDs.map(function (handlerID) {
    var _handlerID$current;

    return _handlersRegistry.handlerIDToTag[handlerID] || ((_handlerID$current = handlerID.current) === null || _handlerID$current === void 0 ? void 0 : _handlerID$current.handlerTag) || -1;
  }).filter(function (handlerTag) {
    return handlerTag > 0;
  });
}

function findNodeHandle(node) {
  if (_reactNative.Platform.OS === 'web') return node;
  return (0, _reactNative.findNodeHandle)(node);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aUNBQWlCQSxJQUFqQixDQUFQO0FBQ0QiLCJuYW1lcyI6WyJjb21tb25Qcm9wcyIsImNvbXBvbmVudEludGVyYWN0aW9uUHJvcHMiLCJiYXNlR2VzdHVyZUhhbmRsZXJQcm9wcyIsImJhc2VHZXN0dXJlSGFuZGxlcldpdGhNb25pdG9yUHJvcHMiLCJpc0NvbmZpZ1BhcmFtIiwicGFyYW0iLCJuYW1lIiwidW5kZWZpbmVkIiwiT2JqZWN0IiwiZmlsdGVyQ29uZmlnIiwicHJvcHMiLCJ2YWxpZFByb3BzIiwiZGVmYXVsdHMiLCJmaWx0ZXJlZENvbmZpZyIsImtleSIsInZhbHVlIiwidHJhbnNmb3JtSW50b0hhbmRsZXJUYWdzIiwidG9wIiwibGVmdCIsImJvdHRvbSIsInJpZ2h0IiwiaGFuZGxlcklEcyIsIlBsYXRmb3JtIiwiT1MiLCJtYXAiLCJjdXJyZW50IiwiZmlsdGVyIiwiaGFuZGxlIiwiaGFuZGxlcklEIiwiaGFuZGxlcklEVG9UYWciLCJfaGFuZGxlcklEJGN1cnJlbnQiLCJoYW5kbGVyVGFnIiwiZmluZE5vZGVIYW5kbGUiLCJub2RlIl0sInNvdXJjZXMiOlsiZ2VzdHVyZUhhbmRsZXJDb21tb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gUHJldmlvdXMgdHlwZXMgZXhwb3J0ZWQgZ2VzdHVyZSBoYW5kbGVycyBhcyBjbGFzc2VzIHdoaWNoIGNyZWF0ZXMgYW4gaW50ZXJmYWNlIGFuZCB2YXJpYWJsZSwgYm90aCBuYW1lZCB0aGUgc2FtZSBhcyBjbGFzcy5cbi8vIFdpdGhvdXQgdGhvc2UgdHlwZXMsIHdlJ2QgaW50cm9kdWNlIGJyZWFraW5nIGNoYW5nZSwgZm9yY2luZyB1c2VycyB0byBwcmVmaXggZXZlcnkgaGFuZGxlciB0eXBlIHNwZWNpZmljYXRpb24gd2l0aCB0eXBlb2Zcbi8vIGUuZy4gUmVhY3QuY3JlYXRlUmVmPFRhcEdlc3R1cmVIYW5kbGVyPiAtPiBSZWFjdC5jcmVhdGVSZWY8dHlwZW9mIFRhcEdlc3R1cmVIYW5kbGVyPi5cbi8vIFNlZSBodHRwczovL3d3dy50eXBlc2NyaXB0bGFuZy5vcmcvZG9jcy9oYW5kYm9vay9jbGFzc2VzLmh0bWwjY29uc3RydWN0b3ItZnVuY3Rpb25zIGZvciByZWZlcmVuY2UuXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBQbGF0Zm9ybSwgZmluZE5vZGVIYW5kbGUgYXMgZmluZE5vZGVIYW5kbGVSTiB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5cbmltcG9ydCB7IFN0YXRlIH0gZnJvbSAnLi4vU3RhdGUnO1xuaW1wb3J0IHsgRXZlbnRUeXBlIH0gZnJvbSAnLi4vRXZlbnRUeXBlJztcbmltcG9ydCB7IFZhbHVlT2YgfSBmcm9tICcuLi90eXBlVXRpbHMnO1xuaW1wb3J0IHsgaGFuZGxlcklEVG9UYWcgfSBmcm9tICcuL2hhbmRsZXJzUmVnaXN0cnknO1xuaW1wb3J0IHsgdG9BcnJheSB9IGZyb20gJy4uL3V0aWxzJztcblxuY29uc3QgY29tbW9uUHJvcHMgPSBbXG4gICdpZCcsXG4gICdlbmFibGVkJyxcbiAgJ3Nob3VsZENhbmNlbFdoZW5PdXRzaWRlJyxcbiAgJ2hpdFNsb3AnLFxuXSBhcyBjb25zdDtcblxuY29uc3QgY29tcG9uZW50SW50ZXJhY3Rpb25Qcm9wcyA9IFsnd2FpdEZvcicsICdzaW11bHRhbmVvdXNIYW5kbGVycyddIGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgYmFzZUdlc3R1cmVIYW5kbGVyUHJvcHMgPSBbXG4gIC4uLmNvbW1vblByb3BzLFxuICAuLi5jb21wb25lbnRJbnRlcmFjdGlvblByb3BzLFxuICAnb25CZWdhbicsXG4gICdvbkZhaWxlZCcsXG4gICdvbkNhbmNlbGxlZCcsXG4gICdvbkFjdGl2YXRlZCcsXG4gICdvbkVuZGVkJyxcbiAgJ29uR2VzdHVyZUV2ZW50JyxcbiAgJ29uSGFuZGxlclN0YXRlQ2hhbmdlJyxcbl0gYXMgY29uc3Q7XG5cbmV4cG9ydCBjb25zdCBiYXNlR2VzdHVyZUhhbmRsZXJXaXRoTW9uaXRvclByb3BzID0gW1xuICAuLi5jb21tb25Qcm9wcyxcbiAgJ25lZWRzUG9pbnRlckRhdGEnLFxuICAnbWFudWFsQWN0aXZhdGlvbicsXG5dO1xuXG5leHBvcnQgaW50ZXJmYWNlIEdlc3R1cmVFdmVudFBheWxvYWQge1xuICBoYW5kbGVyVGFnOiBudW1iZXI7XG4gIG51bWJlck9mUG9pbnRlcnM6IG51bWJlcjtcbiAgc3RhdGU6IFZhbHVlT2Y8dHlwZW9mIFN0YXRlPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFBheWxvYWQge1xuICBoYW5kbGVyVGFnOiBudW1iZXI7XG4gIG51bWJlck9mUG9pbnRlcnM6IG51bWJlcjtcbiAgc3RhdGU6IFZhbHVlT2Y8dHlwZW9mIFN0YXRlPjtcbiAgb2xkU3RhdGU6IFZhbHVlT2Y8dHlwZW9mIFN0YXRlPjtcbn1cblxuZXhwb3J0IHR5cGUgSGl0U2xvcCA9XG4gIHwgbnVtYmVyXG4gIHwgUGFydGlhbDxcbiAgICAgIFJlY29yZDxcbiAgICAgICAgJ2xlZnQnIHwgJ3JpZ2h0JyB8ICd0b3AnIHwgJ2JvdHRvbScgfCAndmVydGljYWwnIHwgJ2hvcml6b250YWwnLFxuICAgICAgICBudW1iZXJcbiAgICAgID5cbiAgICA+XG4gIHwgUmVjb3JkPCd3aWR0aCcgfCAnbGVmdCcsIG51bWJlcj5cbiAgfCBSZWNvcmQ8J3dpZHRoJyB8ICdyaWdodCcsIG51bWJlcj5cbiAgfCBSZWNvcmQ8J2hlaWdodCcgfCAndG9wJywgbnVtYmVyPlxuICB8IFJlY29yZDwnaGVpZ2h0JyB8ICdib3R0b20nLCBudW1iZXI+O1xuXG4vL1RPRE8oVFMpIGV2ZW50cyBpbiBoYW5kbGVyc1xuXG5leHBvcnQgaW50ZXJmYWNlIEdlc3R1cmVFdmVudDxFeHRyYUV2ZW50UGF5bG9hZFQgPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICBuYXRpdmVFdmVudDogUmVhZG9ubHk8R2VzdHVyZUV2ZW50UGF5bG9hZCAmIEV4dHJhRXZlbnRQYXlsb2FkVD47XG59XG5leHBvcnQgaW50ZXJmYWNlIEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50PFxuICBFeHRyYUV2ZW50UGF5bG9hZFQgPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPiB7XG4gIG5hdGl2ZUV2ZW50OiBSZWFkb25seTxIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFBheWxvYWQgJiBFeHRyYUV2ZW50UGF5bG9hZFQ+O1xufVxuXG5leHBvcnQgdHlwZSBUb3VjaERhdGEgPSB7XG4gIGlkOiBudW1iZXI7XG4gIHg6IG51bWJlcjtcbiAgeTogbnVtYmVyO1xuICBhYnNvbHV0ZVg6IG51bWJlcjtcbiAgYWJzb2x1dGVZOiBudW1iZXI7XG59O1xuXG5leHBvcnQgdHlwZSBHZXN0dXJlVG91Y2hFdmVudCA9IHtcbiAgaGFuZGxlclRhZzogbnVtYmVyO1xuICBudW1iZXJPZlRvdWNoZXM6IG51bWJlcjtcbiAgc3RhdGU6IFZhbHVlT2Y8dHlwZW9mIFN0YXRlPjtcbiAgZXZlbnRUeXBlOiBFdmVudFR5cGU7XG4gIGFsbFRvdWNoZXM6IFRvdWNoRGF0YVtdO1xuICBjaGFuZ2VkVG91Y2hlczogVG91Y2hEYXRhW107XG59O1xuXG5leHBvcnQgdHlwZSBHZXN0dXJlVXBkYXRlRXZlbnQ8XG4gIEdlc3R1cmVFdmVudFBheWxvYWRUID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbj4gPSBHZXN0dXJlRXZlbnRQYXlsb2FkICYgR2VzdHVyZUV2ZW50UGF5bG9hZFQ7XG5cbmV4cG9ydCB0eXBlIEdlc3R1cmVTdGF0ZUNoYW5nZUV2ZW50PFxuICBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudFBheWxvYWRUID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbj4gPSBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFBheWxvYWQgJiBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudFBheWxvYWRUO1xuXG5leHBvcnQgdHlwZSBDb21tb25HZXN0dXJlQ29uZmlnID0ge1xuICBlbmFibGVkPzogYm9vbGVhbjtcbiAgc2hvdWxkQ2FuY2VsV2hlbk91dHNpZGU/OiBib29sZWFuO1xuICBoaXRTbG9wPzogSGl0U2xvcDtcbn07XG5cbi8vIEV2ZW50cyBwYXlsb2FkcyBhcmUgdHlwZXMgaW5zdGVhZCBvZiBpbnRlcmZhY2VzIGR1ZSB0byBUUyBsaW1pdGF0aW9uLlxuLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTUzMDAgZm9yIG1vcmUgaW5mby5cbmV4cG9ydCB0eXBlIEJhc2VHZXN0dXJlSGFuZGxlclByb3BzPFxuICBFeHRyYUV2ZW50UGF5bG9hZFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4+ID0gQ29tbW9uR2VzdHVyZUNvbmZpZyAmIHtcbiAgaWQ/OiBzdHJpbmc7XG4gIHdhaXRGb3I/OiBSZWFjdC5SZWY8dW5rbm93bj4gfCBSZWFjdC5SZWY8dW5rbm93bj5bXTtcbiAgc2ltdWx0YW5lb3VzSGFuZGxlcnM/OiBSZWFjdC5SZWY8dW5rbm93bj4gfCBSZWFjdC5SZWY8dW5rbm93bj5bXTtcbiAgLy8gVE9ETyhUUykgLSBmaXggZXZlbnQgdHlwZXNcbiAgb25CZWdhbj86IChldmVudDogSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQpID0+IHZvaWQ7XG4gIG9uRmFpbGVkPzogKGV2ZW50OiBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudCkgPT4gdm9pZDtcbiAgb25DYW5jZWxsZWQ/OiAoZXZlbnQ6IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50KSA9PiB2b2lkO1xuICBvbkFjdGl2YXRlZD86IChldmVudDogSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQpID0+IHZvaWQ7XG4gIG9uRW5kZWQ/OiAoZXZlbnQ6IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50KSA9PiB2b2lkO1xuXG4gIC8vVE9ETyhUUykgY29uc2lkZXIgdXNpbmcgTmF0aXZlU3ludGhldGljRXZlbnRcbiAgb25HZXN0dXJlRXZlbnQ/OiAoZXZlbnQ6IEdlc3R1cmVFdmVudDxFeHRyYUV2ZW50UGF5bG9hZFQ+KSA9PiB2b2lkO1xuICBvbkhhbmRsZXJTdGF0ZUNoYW5nZT86IChcbiAgICBldmVudDogSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQ8RXh0cmFFdmVudFBheWxvYWRUPlxuICApID0+IHZvaWQ7XG59O1xuXG5mdW5jdGlvbiBpc0NvbmZpZ1BhcmFtKHBhcmFtOiB1bmtub3duLCBuYW1lOiBzdHJpbmcpIHtcbiAgLy8gcGFyYW0gIT09IE9iamVjdChwYXJhbSkgcmV0dXJucyBmYWxzZSBpZiBgcGFyYW1gIGlzIGEgZnVuY3Rpb25cbiAgLy8gb3IgYW4gb2JqZWN0IGFuZCByZXR1cm5zIHRydWUgaWYgYHBhcmFtYCBpcyBudWxsXG4gIHJldHVybiAoXG4gICAgcGFyYW0gIT09IHVuZGVmaW5lZCAmJlxuICAgIChwYXJhbSAhPT0gT2JqZWN0KHBhcmFtKSB8fFxuICAgICAgISgnX19pc05hdGl2ZScgaW4gKHBhcmFtIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KSkpICYmXG4gICAgbmFtZSAhPT0gJ29uSGFuZGxlclN0YXRlQ2hhbmdlJyAmJlxuICAgIG5hbWUgIT09ICdvbkdlc3R1cmVFdmVudCdcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlckNvbmZpZyhcbiAgcHJvcHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB2YWxpZFByb3BzOiBzdHJpbmdbXSxcbiAgZGVmYXVsdHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbikge1xuICBjb25zdCBmaWx0ZXJlZENvbmZpZyA9IHsgLi4uZGVmYXVsdHMgfTtcbiAgZm9yIChjb25zdCBrZXkgb2YgdmFsaWRQcm9wcykge1xuICAgIGxldCB2YWx1ZSA9IHByb3BzW2tleV07XG4gICAgaWYgKGlzQ29uZmlnUGFyYW0odmFsdWUsIGtleSkpIHtcbiAgICAgIGlmIChrZXkgPT09ICdzaW11bHRhbmVvdXNIYW5kbGVycycgfHwga2V5ID09PSAnd2FpdEZvcicpIHtcbiAgICAgICAgdmFsdWUgPSB0cmFuc2Zvcm1JbnRvSGFuZGxlclRhZ3MocHJvcHNba2V5XSk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ2hpdFNsb3AnICYmIHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgdmFsdWUgPSB7IHRvcDogdmFsdWUsIGxlZnQ6IHZhbHVlLCBib3R0b206IHZhbHVlLCByaWdodDogdmFsdWUgfTtcbiAgICAgIH1cbiAgICAgIGZpbHRlcmVkQ29uZmlnW2tleV0gPSB2YWx1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZpbHRlcmVkQ29uZmlnO1xufVxuXG5mdW5jdGlvbiB0cmFuc2Zvcm1JbnRvSGFuZGxlclRhZ3MoaGFuZGxlcklEczogYW55KSB7XG4gIGhhbmRsZXJJRHMgPSB0b0FycmF5KGhhbmRsZXJJRHMpO1xuXG4gIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicpIHtcbiAgICByZXR1cm4gaGFuZGxlcklEc1xuICAgICAgLm1hcCgoeyBjdXJyZW50IH06IHsgY3VycmVudDogYW55IH0pID0+IGN1cnJlbnQpXG4gICAgICAuZmlsdGVyKChoYW5kbGU6IGFueSkgPT4gaGFuZGxlKTtcbiAgfVxuICAvLyBjb252ZXJ0cyBoYW5kbGVyIHN0cmluZyBJRHMgaW50byB0aGVpciBudW1lcmljIHRhZ3NcbiAgcmV0dXJuIGhhbmRsZXJJRHNcbiAgICAubWFwKFxuICAgICAgKGhhbmRsZXJJRDogYW55KSA9PlxuICAgICAgICBoYW5kbGVySURUb1RhZ1toYW5kbGVySURdIHx8IGhhbmRsZXJJRC5jdXJyZW50Py5oYW5kbGVyVGFnIHx8IC0xXG4gICAgKVxuICAgIC5maWx0ZXIoKGhhbmRsZXJUYWc6IG51bWJlcikgPT4gaGFuZGxlclRhZyA+IDApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZE5vZGVIYW5kbGUoXG4gIG5vZGU6IG51bGwgfCBudW1iZXIgfCBSZWFjdC5Db21wb25lbnQ8YW55LCBhbnk+IHwgUmVhY3QuQ29tcG9uZW50Q2xhc3M8YW55PlxuKTogbnVsbCB8IG51bWJlciB8IFJlYWN0LkNvbXBvbmVudDxhbnksIGFueT4gfCBSZWFjdC5Db21wb25lbnRDbGFzczxhbnk+IHtcbiAgaWYgKFBsYXRmb3JtLk9TID09PSAnd2ViJykgcmV0dXJuIG5vZGU7XG4gIHJldHVybiBmaW5kTm9kZUhhbmRsZVJOKG5vZGUpO1xufVxuIl19