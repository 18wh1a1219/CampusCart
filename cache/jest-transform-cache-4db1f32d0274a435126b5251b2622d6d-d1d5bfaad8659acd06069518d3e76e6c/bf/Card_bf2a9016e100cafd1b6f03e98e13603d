0e09280ef0e1f48c32f0b021545fa218
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _objectWithoutProperties2 = _interopRequireDefault2(require("@babel/runtime/helpers/objectWithoutProperties"));

var _excluded = ["elevation", "onLongPress", "onPress", "mode", "children", "style", "theme", "testID", "accessible"];
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _color = _interopRequireDefault(require("color"));

var _colors = require("../../styles/colors");

var _CardContent = _interopRequireDefault(require("./CardContent"));

var _CardActions = _interopRequireDefault(require("./CardActions"));

var _CardCover2 = _interopRequireDefault(require("./CardCover"));

var _CardTitle2 = _interopRequireDefault(require("./CardTitle"));

var _Surface = _interopRequireDefault(require("../Surface"));

var _theming = require("../../core/theming");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

var Card = function Card(_ref) {
  var _ref$elevation = _ref.elevation,
      cardElevation = _ref$elevation === void 0 ? 1 : _ref$elevation,
      onLongPress = _ref.onLongPress,
      onPress = _ref.onPress,
      _ref$mode = _ref.mode,
      cardMode = _ref$mode === void 0 ? 'elevated' : _ref$mode,
      children = _ref.children,
      style = _ref.style,
      theme = _ref.theme,
      testID = _ref.testID,
      accessible = _ref.accessible,
      rest = (0, _objectWithoutProperties2.default)(_ref, _excluded);

  var _React$useRef = React.useRef(new _reactNative.Animated.Value(cardElevation)),
      elevation = _React$useRef.current;

  var _React$useRef2 = React.useRef(new _reactNative.Animated.Value(cardElevation)),
      elevationDarkAdaptive = _React$useRef2.current;

  var animation = theme.animation,
      dark = theme.dark,
      mode = theme.mode,
      roundness = theme.roundness;
  var prevDarkRef = React.useRef(dark);
  React.useEffect(function () {
    prevDarkRef.current = dark;
  });
  var prevDark = prevDarkRef.current;
  var isAdaptiveMode = mode === 'adaptive';
  var animationDuration = 150 * animation.scale;
  React.useEffect(function () {
    if (dark && isAdaptiveMode && !prevDark) {
      elevation.setValue(cardElevation);
      elevationDarkAdaptive.setValue(cardElevation);
    }
  }, [prevDark, dark, isAdaptiveMode, cardElevation, elevation, elevationDarkAdaptive]);

  var runElevationAnimation = function runElevationAnimation(pressType) {
    var isPressTypeIn = pressType === 'in';

    if (dark && isAdaptiveMode) {
      _reactNative.Animated.timing(elevationDarkAdaptive, {
        toValue: isPressTypeIn ? 8 : cardElevation,
        duration: animationDuration,
        useNativeDriver: false
      }).start();
    } else {
      _reactNative.Animated.timing(elevation, {
        toValue: isPressTypeIn ? 8 : cardElevation,
        duration: animationDuration,
        useNativeDriver: true
      }).start();
    }
  };

  var handlePressIn = function handlePressIn() {
    runElevationAnimation('in');
  };

  var handlePressOut = function handlePressOut() {
    runElevationAnimation('out');
  };

  var total = React.Children.count(children);
  var siblings = React.Children.map(children, function (child) {
    return React.isValidElement(child) && child.type ? child.type.displayName : null;
  });
  var borderColor = (0, _color.default)(dark ? _colors.white : _colors.black).alpha(0.12).rgb().string();
  var computedElevation = dark && isAdaptiveMode ? elevationDarkAdaptive : elevation;
  return React.createElement(_Surface.default, _extends({
    style: [{
      borderRadius: roundness,
      elevation: computedElevation,
      borderColor: borderColor
    }, cardMode === 'outlined' ? styles.outlined : {}, style],
    theme: theme
  }, rest), React.createElement(_reactNative.TouchableWithoutFeedback, {
    delayPressIn: 0,
    disabled: !(onPress || onLongPress),
    onLongPress: onLongPress,
    onPress: onPress,
    onPressIn: onPress || onLongPress ? handlePressIn : undefined,
    onPressOut: onPress || onLongPress ? handlePressOut : undefined,
    testID: testID,
    accessible: accessible
  }, React.createElement(_reactNative.View, {
    style: styles.innerContainer
  }, React.Children.map(children, function (child, index) {
    return React.isValidElement(child) ? React.cloneElement(child, {
      index: index,
      total: total,
      siblings: siblings
    }) : child;
  }))));
};

Card.Content = _CardContent.default;
Card.Actions = _CardActions.default;
Card.Cover = _CardCover2.default;
Card.Title = _CardTitle2.default;

var styles = _reactNative.StyleSheet.create({
  innerContainer: {
    flexGrow: 1,
    flexShrink: 1
  },
  outlined: {
    elevation: 0,
    borderWidth: 1
  }
});

var _default = (0, _theming.withTheme)(Card);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUksQ0FBQzBFLEtBQUwxRSxHQUFhMkUsbUJBQWIzRTs7QUFFQSxJQUFNeUQsTUFBTSxHQUFHbUIsd0JBQVdDLE1BQVhELENBQWtCO0VBQy9CWCxjQUFjLEVBQUU7SUFDZGEsUUFBUSxFQUFFLENBREk7SUFFZEMsVUFBVSxFQUFFO0VBRkUsQ0FEZTtFQUsvQnJCLFFBQVEsRUFBRTtJQUNSekQsU0FBUyxFQUFFLENBREg7SUFFUitFLFdBQVcsRUFBRTtFQUZMO0FBTHFCLENBQWxCSixDQUFmOztlQVdlLHdCQUFVNUUsSUFBViIsIm5hbWVzIjpbIkNhcmQiLCJlbGV2YXRpb24iLCJjYXJkRWxldmF0aW9uIiwib25Mb25nUHJlc3MiLCJvblByZXNzIiwibW9kZSIsImNhcmRNb2RlIiwiY2hpbGRyZW4iLCJzdHlsZSIsInRoZW1lIiwidGVzdElEIiwiYWNjZXNzaWJsZSIsInJlc3QiLCJSZWFjdCIsInVzZVJlZiIsIkFuaW1hdGVkIiwiVmFsdWUiLCJjdXJyZW50IiwiZWxldmF0aW9uRGFya0FkYXB0aXZlIiwiYW5pbWF0aW9uIiwiZGFyayIsInJvdW5kbmVzcyIsInByZXZEYXJrUmVmIiwidXNlRWZmZWN0IiwicHJldkRhcmsiLCJpc0FkYXB0aXZlTW9kZSIsImFuaW1hdGlvbkR1cmF0aW9uIiwic2NhbGUiLCJzZXRWYWx1ZSIsInJ1bkVsZXZhdGlvbkFuaW1hdGlvbiIsInByZXNzVHlwZSIsImlzUHJlc3NUeXBlSW4iLCJ0aW1pbmciLCJ0b1ZhbHVlIiwiZHVyYXRpb24iLCJ1c2VOYXRpdmVEcml2ZXIiLCJzdGFydCIsImhhbmRsZVByZXNzSW4iLCJoYW5kbGVQcmVzc091dCIsInRvdGFsIiwiQ2hpbGRyZW4iLCJjb3VudCIsInNpYmxpbmdzIiwibWFwIiwiY2hpbGQiLCJpc1ZhbGlkRWxlbWVudCIsInR5cGUiLCJkaXNwbGF5TmFtZSIsImJvcmRlckNvbG9yIiwid2hpdGUiLCJibGFjayIsImFscGhhIiwicmdiIiwic3RyaW5nIiwiY29tcHV0ZWRFbGV2YXRpb24iLCJfU3VyZmFjZSIsImJvcmRlclJhZGl1cyIsInN0eWxlcyIsIm91dGxpbmVkIiwiX3JlYWN0TmF0aXZlIiwiZGVsYXlQcmVzc0luIiwiZGlzYWJsZWQiLCJvblByZXNzSW4iLCJ1bmRlZmluZWQiLCJvblByZXNzT3V0IiwiaW5uZXJDb250YWluZXIiLCJpbmRleCIsImNsb25lRWxlbWVudCIsIkNvbnRlbnQiLCJDYXJkQ29udGVudCIsIkFjdGlvbnMiLCJDYXJkQWN0aW9ucyIsIkNvdmVyIiwiQ2FyZENvdmVyIiwiVGl0bGUiLCJDYXJkVGl0bGUiLCJTdHlsZVNoZWV0IiwiY3JlYXRlIiwiZmxleEdyb3ciLCJmbGV4U2hyaW5rIiwiYm9yZGVyV2lkdGgiXSwic291cmNlcyI6WyJDYXJkLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQge1xuICBTdHlsZVByb3AsXG4gIFN0eWxlU2hlZXQsXG4gIEFuaW1hdGVkLFxuICBUb3VjaGFibGVXaXRob3V0RmVlZGJhY2ssXG4gIFZpZXcsXG4gIFZpZXdTdHlsZSxcbn0gZnJvbSAncmVhY3QtbmF0aXZlJztcbmltcG9ydCBjb2xvciBmcm9tICdjb2xvcic7XG5pbXBvcnQgeyB3aGl0ZSwgYmxhY2sgfSBmcm9tICcuLi8uLi9zdHlsZXMvY29sb3JzJztcbmltcG9ydCBDYXJkQ29udGVudCBmcm9tICcuL0NhcmRDb250ZW50JztcbmltcG9ydCBDYXJkQWN0aW9ucyBmcm9tICcuL0NhcmRBY3Rpb25zJztcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbmltcG9ydCBDYXJkQ292ZXIsIHsgQ2FyZENvdmVyIGFzIF9DYXJkQ292ZXIgfSBmcm9tICcuL0NhcmRDb3Zlcic7XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG5pbXBvcnQgQ2FyZFRpdGxlLCB7IENhcmRUaXRsZSBhcyBfQ2FyZFRpdGxlIH0gZnJvbSAnLi9DYXJkVGl0bGUnO1xuaW1wb3J0IFN1cmZhY2UgZnJvbSAnLi4vU3VyZmFjZSc7XG5pbXBvcnQgeyB3aXRoVGhlbWUgfSBmcm9tICcuLi8uLi9jb3JlL3RoZW1pbmcnO1xuXG50eXBlIE91dGxpbmVkQ2FyZFByb3BzID0ge1xuICBtb2RlOiAnb3V0bGluZWQnO1xuICBlbGV2YXRpb24/OiBuZXZlcjtcbn07XG5cbnR5cGUgRWxldmF0ZWRDYXJkUHJvcHMgPSB7XG4gIG1vZGU/OiAnZWxldmF0ZWQnO1xuICBlbGV2YXRpb24/OiBudW1iZXI7XG59O1xuXG50eXBlIEhhbmRsZVByZXNzVHlwZSA9ICdpbicgfCAnb3V0JztcblxudHlwZSBQcm9wcyA9IFJlYWN0LkNvbXBvbmVudFByb3BzPHR5cGVvZiBTdXJmYWNlPiAmIHtcbiAgLyoqXG4gICAqIFJlc3RpbmcgZWxldmF0aW9uIG9mIHRoZSBjYXJkIHdoaWNoIGNvbnRyb2xzIHRoZSBkcm9wIHNoYWRvdy5cbiAgICovXG4gIGVsZXZhdGlvbj86IG5ldmVyIHwgbnVtYmVyO1xuICAvKipcbiAgICogRnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBsb25nIHByZXNzLlxuICAgKi9cbiAgb25Mb25nUHJlc3M/OiAoKSA9PiB2b2lkO1xuICAvKipcbiAgICogRnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBwcmVzcy5cbiAgICovXG4gIG9uUHJlc3M/OiAoKSA9PiB2b2lkO1xuICAvKipcbiAgICogTW9kZSBvZiB0aGUgQ2FyZC5cbiAgICogLSBgZWxldmF0ZWRgIC0gQ2FyZCB3aXRoIGVsZXZhdGlvbi5cbiAgICogLSBgb3V0bGluZWRgIC0gQ2FyZCB3aXRoIGFuIG91dGxpbmUuXG4gICAqL1xuICBtb2RlPzogJ2VsZXZhdGVkJyB8ICdvdXRsaW5lZCc7XG4gIC8qKlxuICAgKiBDb250ZW50IG9mIHRoZSBgQ2FyZGAuXG4gICAqL1xuICBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlO1xuICBzdHlsZT86IFN0eWxlUHJvcDxWaWV3U3R5bGU+O1xuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqL1xuICB0aGVtZTogUmVhY3ROYXRpdmVQYXBlci5UaGVtZTtcbiAgLyoqXG4gICAqIFBhc3MgZG93biB0ZXN0SUQgZnJvbSBjYXJkIHByb3BzIHRvIHRvdWNoYWJsZVxuICAgKi9cbiAgdGVzdElEPzogc3RyaW5nO1xuICAvKipcbiAgICogUGFzcyBkb3duIGFjY2Vzc2libGUgZnJvbSBjYXJkIHByb3BzIHRvIHRvdWNoYWJsZVxuICAgKi9cbiAgYWNjZXNzaWJsZT86IGJvb2xlYW47XG59O1xuXG4vKipcbiAqIEEgY2FyZCBpcyBhIHNoZWV0IG9mIG1hdGVyaWFsIHRoYXQgc2VydmVzIGFzIGFuIGVudHJ5IHBvaW50IHRvIG1vcmUgZGV0YWlsZWQgaW5mb3JtYXRpb24uXG4gKlxuICogPGRpdiBjbGFzcz1cInNjcmVlbnNob3RzXCI+XG4gKiAgIDxpbWcgY2xhc3M9XCJtZWRpdW1cIiBzcmM9XCJzY3JlZW5zaG90cy9jYXJkLTEucG5nXCIgLz5cbiAqICAgPGltZyBjbGFzcz1cIm1lZGl1bVwiIHNyYz1cInNjcmVlbnNob3RzL2NhcmQtMi5wbmdcIiAvPlxuICogPC9kaXY+XG4gKlxuICogIyMgVXNhZ2VcbiAqIGBgYGpzXG4gKiBpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG4gKiBpbXBvcnQgeyBBdmF0YXIsIEJ1dHRvbiwgQ2FyZCwgVGl0bGUsIFBhcmFncmFwaCB9IGZyb20gJ3JlYWN0LW5hdGl2ZS1wYXBlcic7XG4gKlxuICogY29uc3QgTGVmdENvbnRlbnQgPSBwcm9wcyA9PiA8QXZhdGFyLkljb24gey4uLnByb3BzfSBpY29uPVwiZm9sZGVyXCIgLz5cbiAqXG4gKiBjb25zdCBNeUNvbXBvbmVudCA9ICgpID0+IChcbiAqICAgPENhcmQ+XG4gKiAgICAgPENhcmQuVGl0bGUgdGl0bGU9XCJDYXJkIFRpdGxlXCIgc3VidGl0bGU9XCJDYXJkIFN1YnRpdGxlXCIgbGVmdD17TGVmdENvbnRlbnR9IC8+XG4gKiAgICAgPENhcmQuQ29udGVudD5cbiAqICAgICAgIDxUaXRsZT5DYXJkIHRpdGxlPC9UaXRsZT5cbiAqICAgICAgIDxQYXJhZ3JhcGg+Q2FyZCBjb250ZW50PC9QYXJhZ3JhcGg+XG4gKiAgICAgPC9DYXJkLkNvbnRlbnQ+XG4gKiAgICAgPENhcmQuQ292ZXIgc291cmNlPXt7IHVyaTogJ2h0dHBzOi8vcGljc3VtLnBob3Rvcy83MDAnIH19IC8+XG4gKiAgICAgPENhcmQuQWN0aW9ucz5cbiAqICAgICAgIDxCdXR0b24+Q2FuY2VsPC9CdXR0b24+XG4gKiAgICAgICA8QnV0dG9uPk9rPC9CdXR0b24+XG4gKiAgICAgPC9DYXJkLkFjdGlvbnM+XG4gKiAgIDwvQ2FyZD5cbiAqICk7XG4gKlxuICogZXhwb3J0IGRlZmF1bHQgTXlDb21wb25lbnQ7XG4gKiBgYGBcbiAqL1xuY29uc3QgQ2FyZCA9ICh7XG4gIGVsZXZhdGlvbjogY2FyZEVsZXZhdGlvbiA9IDEsXG4gIG9uTG9uZ1ByZXNzLFxuICBvblByZXNzLFxuICBtb2RlOiBjYXJkTW9kZSA9ICdlbGV2YXRlZCcsXG4gIGNoaWxkcmVuLFxuICBzdHlsZSxcbiAgdGhlbWUsXG4gIHRlc3RJRCxcbiAgYWNjZXNzaWJsZSxcbiAgLi4ucmVzdFxufTogKE91dGxpbmVkQ2FyZFByb3BzIHwgRWxldmF0ZWRDYXJkUHJvcHMpICYgUHJvcHMpID0+IHtcbiAgLy8gRGVmYXVsdCBhbmltYXRlZCB2YWx1ZVxuICBjb25zdCB7IGN1cnJlbnQ6IGVsZXZhdGlvbiB9ID0gUmVhY3QudXNlUmVmPEFuaW1hdGVkLlZhbHVlPihcbiAgICBuZXcgQW5pbWF0ZWQuVmFsdWUoY2FyZEVsZXZhdGlvbilcbiAgKTtcbiAgLy8gRGFyayBhZGFwdGl2ZSBhbmltYXRlZCB2YWx1ZSwgdXNlZCBpbiBjYXNlIG9mIHRvZ2dsaW5nIHRoZSB0aGVtZSxcbiAgLy8gaXQgcHJldmVudHMgYW5pbWF0aW5nIHRoZSBiYWNrZ3JvdW5kIHdpdGggbmF0aXZlIGRyaXZlcnMgaW5zaWRlIFN1cmZhY2VcbiAgY29uc3QgeyBjdXJyZW50OiBlbGV2YXRpb25EYXJrQWRhcHRpdmUgfSA9IFJlYWN0LnVzZVJlZjxBbmltYXRlZC5WYWx1ZT4oXG4gICAgbmV3IEFuaW1hdGVkLlZhbHVlKGNhcmRFbGV2YXRpb24pXG4gICk7XG4gIGNvbnN0IHsgYW5pbWF0aW9uLCBkYXJrLCBtb2RlLCByb3VuZG5lc3MgfSA9IHRoZW1lO1xuXG4gIGNvbnN0IHByZXZEYXJrUmVmID0gUmVhY3QudXNlUmVmPGJvb2xlYW4+KGRhcmspO1xuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIHByZXZEYXJrUmVmLmN1cnJlbnQgPSBkYXJrO1xuICB9KTtcblxuICBjb25zdCBwcmV2RGFyayA9IHByZXZEYXJrUmVmLmN1cnJlbnQ7XG4gIGNvbnN0IGlzQWRhcHRpdmVNb2RlID0gbW9kZSA9PT0gJ2FkYXB0aXZlJztcbiAgY29uc3QgYW5pbWF0aW9uRHVyYXRpb24gPSAxNTAgKiBhbmltYXRpb24uc2NhbGU7XG5cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICAvKipcbiAgICAgKiBSZXNldHMgYW5pbWF0aW9ucyB2YWx1ZXMgaWYgdXBkYXRpbmcgdG8gZGFyayBhZGFwdGl2ZSBtb2RlLFxuICAgICAqIG90aGVyd2lzZSwgYW55IGNhcmQgdGhhdCBpcyBpbiB0aGUgbWlkZGxlIG9mIGFuaW1hdGlvbiB3aGlsZVxuICAgICAqIHRvZ2dsaW5nIHRoZSB0aGVtZSB3aWxsIHN0YXkgYXQgdGhhdCBhbmltYXRlZCB2YWx1ZSB1bnRpbFxuICAgICAqIHRoZSBuZXh0IHByZXNzLWluXG4gICAgICovXG4gICAgaWYgKGRhcmsgJiYgaXNBZGFwdGl2ZU1vZGUgJiYgIXByZXZEYXJrKSB7XG4gICAgICBlbGV2YXRpb24uc2V0VmFsdWUoY2FyZEVsZXZhdGlvbik7XG4gICAgICBlbGV2YXRpb25EYXJrQWRhcHRpdmUuc2V0VmFsdWUoY2FyZEVsZXZhdGlvbik7XG4gICAgfVxuICB9LCBbXG4gICAgcHJldkRhcmssXG4gICAgZGFyayxcbiAgICBpc0FkYXB0aXZlTW9kZSxcbiAgICBjYXJkRWxldmF0aW9uLFxuICAgIGVsZXZhdGlvbixcbiAgICBlbGV2YXRpb25EYXJrQWRhcHRpdmUsXG4gIF0pO1xuXG4gIGNvbnN0IHJ1bkVsZXZhdGlvbkFuaW1hdGlvbiA9IChwcmVzc1R5cGU6IEhhbmRsZVByZXNzVHlwZSkgPT4ge1xuICAgIGNvbnN0IGlzUHJlc3NUeXBlSW4gPSBwcmVzc1R5cGUgPT09ICdpbic7XG4gICAgaWYgKGRhcmsgJiYgaXNBZGFwdGl2ZU1vZGUpIHtcbiAgICAgIEFuaW1hdGVkLnRpbWluZyhlbGV2YXRpb25EYXJrQWRhcHRpdmUsIHtcbiAgICAgICAgdG9WYWx1ZTogaXNQcmVzc1R5cGVJbiA/IDggOiBjYXJkRWxldmF0aW9uLFxuICAgICAgICBkdXJhdGlvbjogYW5pbWF0aW9uRHVyYXRpb24sXG4gICAgICAgIHVzZU5hdGl2ZURyaXZlcjogZmFsc2UsXG4gICAgICB9KS5zdGFydCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBBbmltYXRlZC50aW1pbmcoZWxldmF0aW9uLCB7XG4gICAgICAgIHRvVmFsdWU6IGlzUHJlc3NUeXBlSW4gPyA4IDogY2FyZEVsZXZhdGlvbixcbiAgICAgICAgZHVyYXRpb246IGFuaW1hdGlvbkR1cmF0aW9uLFxuICAgICAgICB1c2VOYXRpdmVEcml2ZXI6IHRydWUsXG4gICAgICB9KS5zdGFydCgpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBoYW5kbGVQcmVzc0luID0gKCkgPT4ge1xuICAgIHJ1bkVsZXZhdGlvbkFuaW1hdGlvbignaW4nKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVQcmVzc091dCA9ICgpID0+IHtcbiAgICBydW5FbGV2YXRpb25BbmltYXRpb24oJ291dCcpO1xuICB9O1xuXG4gIGNvbnN0IHRvdGFsID0gUmVhY3QuQ2hpbGRyZW4uY291bnQoY2hpbGRyZW4pO1xuICBjb25zdCBzaWJsaW5ncyA9IFJlYWN0LkNoaWxkcmVuLm1hcChjaGlsZHJlbiwgKGNoaWxkKSA9PlxuICAgIFJlYWN0LmlzVmFsaWRFbGVtZW50KGNoaWxkKSAmJiBjaGlsZC50eXBlXG4gICAgICA/IChjaGlsZC50eXBlIGFzIGFueSkuZGlzcGxheU5hbWVcbiAgICAgIDogbnVsbFxuICApO1xuICBjb25zdCBib3JkZXJDb2xvciA9IGNvbG9yKGRhcmsgPyB3aGl0ZSA6IGJsYWNrKVxuICAgIC5hbHBoYSgwLjEyKVxuICAgIC5yZ2IoKVxuICAgIC5zdHJpbmcoKTtcbiAgY29uc3QgY29tcHV0ZWRFbGV2YXRpb24gPVxuICAgIGRhcmsgJiYgaXNBZGFwdGl2ZU1vZGUgPyBlbGV2YXRpb25EYXJrQWRhcHRpdmUgOiBlbGV2YXRpb247XG5cbiAgcmV0dXJuIChcbiAgICA8U3VyZmFjZVxuICAgICAgc3R5bGU9e1tcbiAgICAgICAgeyBib3JkZXJSYWRpdXM6IHJvdW5kbmVzcywgZWxldmF0aW9uOiBjb21wdXRlZEVsZXZhdGlvbiwgYm9yZGVyQ29sb3IgfSxcbiAgICAgICAgY2FyZE1vZGUgPT09ICdvdXRsaW5lZCcgPyBzdHlsZXMub3V0bGluZWQgOiB7fSxcbiAgICAgICAgc3R5bGUsXG4gICAgICBdfVxuICAgICAgdGhlbWU9e3RoZW1lfVxuICAgICAgey4uLnJlc3R9XG4gICAgPlxuICAgICAgPFRvdWNoYWJsZVdpdGhvdXRGZWVkYmFja1xuICAgICAgICBkZWxheVByZXNzSW49ezB9XG4gICAgICAgIGRpc2FibGVkPXshKG9uUHJlc3MgfHwgb25Mb25nUHJlc3MpfVxuICAgICAgICBvbkxvbmdQcmVzcz17b25Mb25nUHJlc3N9XG4gICAgICAgIG9uUHJlc3M9e29uUHJlc3N9XG4gICAgICAgIG9uUHJlc3NJbj17b25QcmVzcyB8fCBvbkxvbmdQcmVzcyA/IGhhbmRsZVByZXNzSW4gOiB1bmRlZmluZWR9XG4gICAgICAgIG9uUHJlc3NPdXQ9e29uUHJlc3MgfHwgb25Mb25nUHJlc3MgPyBoYW5kbGVQcmVzc091dCA6IHVuZGVmaW5lZH1cbiAgICAgICAgdGVzdElEPXt0ZXN0SUR9XG4gICAgICAgIGFjY2Vzc2libGU9e2FjY2Vzc2libGV9XG4gICAgICA+XG4gICAgICAgIDxWaWV3IHN0eWxlPXtzdHlsZXMuaW5uZXJDb250YWluZXJ9PlxuICAgICAgICAgIHtSZWFjdC5DaGlsZHJlbi5tYXAoY2hpbGRyZW4sIChjaGlsZCwgaW5kZXgpID0+XG4gICAgICAgICAgICBSZWFjdC5pc1ZhbGlkRWxlbWVudChjaGlsZClcbiAgICAgICAgICAgICAgPyBSZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGQsIHtcbiAgICAgICAgICAgICAgICAgIGluZGV4LFxuICAgICAgICAgICAgICAgICAgdG90YWwsXG4gICAgICAgICAgICAgICAgICBzaWJsaW5ncyxcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICA6IGNoaWxkXG4gICAgICAgICAgKX1cbiAgICAgICAgPC9WaWV3PlxuICAgICAgPC9Ub3VjaGFibGVXaXRob3V0RmVlZGJhY2s+XG4gICAgPC9TdXJmYWNlPlxuICApO1xufTtcblxuLy8gQGNvbXBvbmVudCAuL0NhcmRDb250ZW50LnRzeFxuQ2FyZC5Db250ZW50ID0gQ2FyZENvbnRlbnQ7XG4vLyBAY29tcG9uZW50IC4vQ2FyZEFjdGlvbnMudHN4XG5DYXJkLkFjdGlvbnMgPSBDYXJkQWN0aW9ucztcbi8vIEBjb21wb25lbnQgLi9DYXJkQ292ZXIudHN4XG5DYXJkLkNvdmVyID0gQ2FyZENvdmVyO1xuLy8gQGNvbXBvbmVudCAuL0NhcmRUaXRsZS50c3hcbkNhcmQuVGl0bGUgPSBDYXJkVGl0bGU7XG5cbmNvbnN0IHN0eWxlcyA9IFN0eWxlU2hlZXQuY3JlYXRlKHtcbiAgaW5uZXJDb250YWluZXI6IHtcbiAgICBmbGV4R3JvdzogMSxcbiAgICBmbGV4U2hyaW5rOiAxLFxuICB9LFxuICBvdXRsaW5lZDoge1xuICAgIGVsZXZhdGlvbjogMCxcbiAgICBib3JkZXJXaWR0aDogMSxcbiAgfSxcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCB3aXRoVGhlbWUoQ2FyZCk7XG4iXX0=