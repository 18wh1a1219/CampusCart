450d5200868914f92544bfeccc3642af
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault2(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault2(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault2(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault2(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault2(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault2(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty3 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

var _extends2 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _stateToPropMappings;

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createHandler;

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _isEqual = _interopRequireDefault(require("lodash/isEqual"));

var _RNGestureHandlerModule = _interopRequireDefault(require("../RNGestureHandlerModule"));

var _State = require("../State");

var _handlersRegistry = require("./handlersRegistry");

var _gestureHandlerCommon = require("./gestureHandlerCommon");

var _UIManagerAny$getView, _UIManagerAny$getView2, _UIManagerAny$getCons;

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

var UIManagerAny = _reactNative.UIManager;
var customGHEventsConfig = {
  onGestureHandlerEvent: {
    registrationName: 'onGestureHandlerEvent'
  },
  onGestureHandlerStateChange: {
    registrationName: 'onGestureHandlerStateChange'
  }
};
UIManagerAny.genericDirectEventTypes = (0, _extends2.default)({}, UIManagerAny.genericDirectEventTypes, customGHEventsConfig);
var UIManagerConstants = (_UIManagerAny$getView = (_UIManagerAny$getView2 = UIManagerAny.getViewManagerConfig) === null || _UIManagerAny$getView2 === void 0 ? void 0 : _UIManagerAny$getView2.call(UIManagerAny, 'getConstants')) !== null && _UIManagerAny$getView !== void 0 ? _UIManagerAny$getView : (_UIManagerAny$getCons = UIManagerAny.getConstants) === null || _UIManagerAny$getCons === void 0 ? void 0 : _UIManagerAny$getCons.call(UIManagerAny);

if (UIManagerConstants) {
  UIManagerConstants.genericDirectEventTypes = (0, _extends2.default)({}, UIManagerConstants.genericDirectEventTypes, customGHEventsConfig);
}

var _UIManagerAny$setJSRe = UIManagerAny.setJSResponder,
    oldSetJSResponder = _UIManagerAny$setJSRe === void 0 ? function () {} : _UIManagerAny$setJSRe,
    _UIManagerAny$clearJS = UIManagerAny.clearJSResponder,
    oldClearJSResponder = _UIManagerAny$clearJS === void 0 ? function () {} : _UIManagerAny$clearJS;

UIManagerAny.setJSResponder = function (tag, blockNativeResponder) {
  _RNGestureHandlerModule.default.handleSetJSResponder(tag, blockNativeResponder);

  oldSetJSResponder(tag, blockNativeResponder);
};

UIManagerAny.clearJSResponder = function () {
  _RNGestureHandlerModule.default.handleClearJSResponder();

  oldClearJSResponder();
};

var allowTouches = true;
var DEV_ON_ANDROID = __DEV__ && _reactNative.Platform.OS === 'android';

if (DEV_ON_ANDROID) {
  _reactNative.DeviceEventEmitter.addListener('toggleElementInspector', function () {
    allowTouches = !allowTouches;
  });
}

function hasUnresolvedRefs(props) {
  var extract = function extract(refs) {
    if (!Array.isArray(refs)) {
      return refs && refs.current === null;
    }

    return refs.some(function (r) {
      return r && r.current === null;
    });
  };

  return extract(props['simultaneousHandlers']) || extract(props['waitFor']);
}

var stateToPropMappings = (_stateToPropMappings = {}, (0, _defineProperty3.default)(_stateToPropMappings, _State.State.UNDETERMINED, undefined), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.BEGAN, 'onBegan'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.FAILED, 'onFailed'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.CANCELLED, 'onCancelled'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.ACTIVE, 'onActivated'), (0, _defineProperty3.default)(_stateToPropMappings, _State.State.END, 'onEnded'), _stateToPropMappings);

function createHandler(_ref) {
  var name = _ref.name,
      _ref$allowedProps = _ref.allowedProps,
      allowedProps = _ref$allowedProps === void 0 ? [] : _ref$allowedProps,
      _ref$config = _ref.config,
      config = _ref$config === void 0 ? {} : _ref$config,
      transformProps = _ref.transformProps,
      _ref$customNativeProp = _ref.customNativeProps,
      customNativeProps = _ref$customNativeProp === void 0 ? [] : _ref$customNativeProp;

  var Handler = function (_React$Component) {
    (0, _inherits2.default)(Handler, _React$Component);

    var _super = _createSuper(Handler);

    function Handler(props) {
      var _this;

      (0, _classCallCheck2.default)(this, Handler);
      _this = _super.call(this, props);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "handlerTag", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "config", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "propsRef", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "viewNode", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "viewTag", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "updateEnqueued", null);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "inspectorToggleListener", void 0);

      _defineProperty((0, _assertThisInitialized2.default)(_this), "onGestureHandlerEvent", function (event) {
        if (event.nativeEvent.handlerTag === _this.handlerTag) {
          var _this$props$onGesture, _this$props;

          (_this$props$onGesture = (_this$props = _this.props).onGestureEvent) === null || _this$props$onGesture === void 0 ? void 0 : _this$props$onGesture.call(_this$props, event);
        } else {
          var _this$props$onGesture2, _this$props2;

          (_this$props$onGesture2 = (_this$props2 = _this.props).onGestureHandlerEvent) === null || _this$props$onGesture2 === void 0 ? void 0 : _this$props$onGesture2.call(_this$props2, event);
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "onGestureHandlerStateChange", function (event) {
        if (event.nativeEvent.handlerTag === _this.handlerTag) {
          var _this$props$onHandler, _this$props3;

          (_this$props$onHandler = (_this$props3 = _this.props).onHandlerStateChange) === null || _this$props$onHandler === void 0 ? void 0 : _this$props$onHandler.call(_this$props3, event);
          var state = event.nativeEvent.state;
          var stateEventName = stateToPropMappings[state];
          var eventHandler = stateEventName && _this.props[stateEventName];

          if (eventHandler && typeof eventHandler === 'function') {
            eventHandler(event);
          }
        } else {
          var _this$props$onGesture3, _this$props4;

          (_this$props$onGesture3 = (_this$props4 = _this.props).onGestureHandlerStateChange) === null || _this$props$onGesture3 === void 0 ? void 0 : _this$props$onGesture3.call(_this$props4, event);
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "refHandler", function (node) {
        _this.viewNode = node;
        var child = React.Children.only(_this.props.children);
        var ref = child.ref;

        if (ref !== null) {
          if (typeof ref === 'function') {
            ref(node);
          } else {
            ref.current = node;
          }
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "createGestureHandler", function (newConfig) {
        _this.config = newConfig;

        _RNGestureHandlerModule.default.createGestureHandler(name, _this.handlerTag, newConfig);
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "attachGestureHandler", function (newViewTag) {
        _this.viewTag = newViewTag;

        if (_reactNative.Platform.OS === 'web') {
          _RNGestureHandlerModule.default.attachGestureHandler(_this.handlerTag, newViewTag, false, _this.propsRef);
        } else {
          _RNGestureHandlerModule.default.attachGestureHandler(_this.handlerTag, newViewTag, false);
        }
      });

      _defineProperty((0, _assertThisInitialized2.default)(_this), "updateGestureHandler", function (newConfig) {
        _this.config = newConfig;

        _RNGestureHandlerModule.default.updateGestureHandler(_this.handlerTag, newConfig);
      });

      _this.handlerTag = (0, _handlersRegistry.getNextHandlerTag)();
      _this.config = {};
      _this.propsRef = React.createRef();
      _this.state = {
        allowTouches: allowTouches
      };

      if (props.id) {
        if (_handlersRegistry.handlerIDToTag[props.id] !== undefined) {
          throw new Error("Handler with ID \"" + props.id + "\" already registered");
        }

        _handlersRegistry.handlerIDToTag[props.id] = _this.handlerTag;
      }

      return _this;
    }

    (0, _createClass2.default)(Handler, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this2 = this;

        var props = this.props;

        if (DEV_ON_ANDROID) {
          this.inspectorToggleListener = _reactNative.DeviceEventEmitter.addListener('toggleElementInspector', function () {
            _this2.setState(function (_) {
              return {
                allowTouches: allowTouches
              };
            });

            _this2.update();
          });
        }

        if (hasUnresolvedRefs(props)) {
          this.updateEnqueued = setImmediate(function () {
            _this2.updateEnqueued = null;

            _this2.update();
          });
        }

        this.createGestureHandler((0, _gestureHandlerCommon.filterConfig)(transformProps ? transformProps(this.props) : this.props, [].concat((0, _toConsumableArray2.default)(allowedProps), (0, _toConsumableArray2.default)(customNativeProps)), config));
        this.attachGestureHandler((0, _gestureHandlerCommon.findNodeHandle)(this.viewNode));
      }
    }, {
      key: "componentDidUpdate",
      value: function componentDidUpdate() {
        var viewTag = (0, _gestureHandlerCommon.findNodeHandle)(this.viewNode);

        if (this.viewTag !== viewTag) {
          this.attachGestureHandler(viewTag);
        }

        this.update();
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        var _this$inspectorToggle;

        (_this$inspectorToggle = this.inspectorToggleListener) === null || _this$inspectorToggle === void 0 ? void 0 : _this$inspectorToggle.remove();

        _RNGestureHandlerModule.default.dropGestureHandler(this.handlerTag);

        if (this.updateEnqueued) {
          clearImmediate(this.updateEnqueued);
        }

        var handlerID = this.props.id;

        if (handlerID) {
          delete _handlersRegistry.handlerIDToTag[handlerID];
        }
      }
    }, {
      key: "update",
      value: function update() {
        var newConfig = (0, _gestureHandlerCommon.filterConfig)(transformProps ? transformProps(this.props) : this.props, [].concat((0, _toConsumableArray2.default)(allowedProps), (0, _toConsumableArray2.default)(customNativeProps)), config);

        if (!(0, _isEqual.default)(this.config, newConfig)) {
          this.updateGestureHandler(newConfig);
        }
      }
    }, {
      key: "setNativeProps",
      value: function setNativeProps(updates) {
        var mergedProps = (0, _extends2.default)({}, this.props, updates);
        var newConfig = (0, _gestureHandlerCommon.filterConfig)(transformProps ? transformProps(mergedProps) : mergedProps, [].concat((0, _toConsumableArray2.default)(allowedProps), (0, _toConsumableArray2.default)(customNativeProps)), config);
        this.updateGestureHandler(newConfig);
      }
    }, {
      key: "render",
      value: function render() {
        var gestureEventHandler = this.onGestureHandlerEvent;
        var _this$props5 = this.props,
            onGestureEvent = _this$props5.onGestureEvent,
            onGestureHandlerEvent = _this$props5.onGestureHandlerEvent;

        if (onGestureEvent && typeof onGestureEvent !== 'function') {
          if (onGestureHandlerEvent) {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }

          gestureEventHandler = onGestureEvent;
        } else {
          if (onGestureHandlerEvent && typeof onGestureHandlerEvent !== 'function') {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }
        }

        var gestureStateEventHandler = this.onGestureHandlerStateChange;
        var _this$props6 = this.props,
            onHandlerStateChange = _this$props6.onHandlerStateChange,
            onGestureHandlerStateChange = _this$props6.onGestureHandlerStateChange;

        if (onHandlerStateChange && typeof onHandlerStateChange !== 'function') {
          if (onGestureHandlerStateChange) {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }

          gestureStateEventHandler = onHandlerStateChange;
        } else {
          if (onGestureHandlerStateChange && typeof onGestureHandlerStateChange !== 'function') {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }
        }

        var events = {
          onGestureHandlerEvent: this.state.allowTouches ? gestureEventHandler : undefined,
          onGestureHandlerStateChange: this.state.allowTouches ? gestureStateEventHandler : undefined
        };
        this.propsRef.current = events;
        var child = React.Children.only(this.props.children);
        var grandChildren = child.props.children;

        if (_reactNative.Touchable.TOUCH_TARGET_DEBUG && child.type && (child.type === 'RNGestureHandlerButton' || child.type.name === 'View' || child.type.displayName === 'View')) {
          grandChildren = React.Children.toArray(grandChildren);
          grandChildren.push(_reactNative.Touchable.renderDebugView({
            color: 'mediumspringgreen',
            hitSlop: child.props.hitSlop
          }));
        }

        return React.cloneElement(child, (0, _extends2.default)({
          ref: this.refHandler,
          collapsable: false
        }, events), grandChildren);
      }
    }]);
    return Handler;
  }(React.Component);

  _defineProperty(Handler, "displayName", name);

  return Handler;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VU0sZUFBVk4sQ0FBMEI7WUFDeEJPLEtBQUssRUFBRSxtQkFEaUI7WUFFeEJDLE9BQU8sRUFBRTlDLEtBQUssQ0FBQ3BDLEtBQU5vQyxDQUFZOEM7VUFGRyxDQUExQlIsQ0FERkQ7UUFNRDs7UUFFRCxPQUFPcEMsS0FBSyxDQUFDOEMsWUFBTjlDLENBQ0xELEtBREtDO1VBR0hJLEdBQUcsRUFBRSxLQUFLMkMsVUFIUC9DO1VBSUhnRCxXQUFXLEVBQUU7UUFKVmhELEdBS0FtQyxNQUxBbkMsR0FPTG9DLGFBUEtwQyxDQUFQO01BU0Q7SUFwU3VFO0lBQUE7RUFBQSxFQUlwREEsS0FBSyxDQUFDaUQsU0FKOEM7O0VBQUE3RCxnQkFJcEVGLE9BSm9FLGlCQVFuREwsSUFSbUQ7O0VBc1MxRSxPQUFPSyxPQUFQO0FBQ0QiLCJuYW1lcyI6WyJVSU1hbmFnZXJBbnkiLCJVSU1hbmFnZXIiLCJjdXN0b21HSEV2ZW50c0NvbmZpZyIsIm9uR2VzdHVyZUhhbmRsZXJFdmVudCIsInJlZ2lzdHJhdGlvbk5hbWUiLCJvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UiLCJnZW5lcmljRGlyZWN0RXZlbnRUeXBlcyIsIlVJTWFuYWdlckNvbnN0YW50cyIsImdldFZpZXdNYW5hZ2VyQ29uZmlnIiwiX1VJTWFuYWdlckFueSRnZXRWaWV3MiIsImdldENvbnN0YW50cyIsIl9VSU1hbmFnZXJBbnkkZ2V0Q29ucyIsInNldEpTUmVzcG9uZGVyIiwib2xkU2V0SlNSZXNwb25kZXIiLCJjbGVhckpTUmVzcG9uZGVyIiwib2xkQ2xlYXJKU1Jlc3BvbmRlciIsInRhZyIsImJsb2NrTmF0aXZlUmVzcG9uZGVyIiwiUk5HZXN0dXJlSGFuZGxlck1vZHVsZSIsImhhbmRsZVNldEpTUmVzcG9uZGVyIiwiaGFuZGxlQ2xlYXJKU1Jlc3BvbmRlciIsImFsbG93VG91Y2hlcyIsIkRFVl9PTl9BTkRST0lEIiwiX19ERVZfXyIsIlBsYXRmb3JtIiwiT1MiLCJEZXZpY2VFdmVudEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImhhc1VucmVzb2x2ZWRSZWZzIiwicHJvcHMiLCJleHRyYWN0IiwicmVmcyIsIkFycmF5IiwiaXNBcnJheSIsImN1cnJlbnQiLCJzb21lIiwiciIsInN0YXRlVG9Qcm9wTWFwcGluZ3MiLCJTdGF0ZSIsIlVOREVURVJNSU5FRCIsInVuZGVmaW5lZCIsIkJFR0FOIiwiRkFJTEVEIiwiQ0FOQ0VMTEVEIiwiQUNUSVZFIiwiRU5EIiwiY3JlYXRlSGFuZGxlciIsIm5hbWUiLCJhbGxvd2VkUHJvcHMiLCJjb25maWciLCJ0cmFuc2Zvcm1Qcm9wcyIsImN1c3RvbU5hdGl2ZVByb3BzIiwiSGFuZGxlciIsImNvbnN0cnVjdG9yIiwiX2RlZmluZVByb3BlcnR5IiwiZXZlbnQiLCJuYXRpdmVFdmVudCIsImhhbmRsZXJUYWciLCJvbkdlc3R1cmVFdmVudCIsIm9uSGFuZGxlclN0YXRlQ2hhbmdlIiwic3RhdGUiLCJzdGF0ZUV2ZW50TmFtZSIsImV2ZW50SGFuZGxlciIsIm5vZGUiLCJ2aWV3Tm9kZSIsImNoaWxkIiwiUmVhY3QiLCJDaGlsZHJlbiIsIm9ubHkiLCJjaGlsZHJlbiIsInJlZiIsIm5ld0NvbmZpZyIsImNyZWF0ZUdlc3R1cmVIYW5kbGVyIiwibmV3Vmlld1RhZyIsInZpZXdUYWciLCJhdHRhY2hHZXN0dXJlSGFuZGxlciIsInByb3BzUmVmIiwidXBkYXRlR2VzdHVyZUhhbmRsZXIiLCJjcmVhdGVSZWYiLCJpZCIsImhhbmRsZXJJRFRvVGFnIiwiRXJyb3IiLCJjb21wb25lbnREaWRNb3VudCIsImluc3BlY3RvclRvZ2dsZUxpc3RlbmVyIiwic2V0U3RhdGUiLCJfIiwidXBkYXRlIiwidXBkYXRlRW5xdWV1ZWQiLCJzZXRJbW1lZGlhdGUiLCJjb21wb25lbnREaWRVcGRhdGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInJlbW92ZSIsImRyb3BHZXN0dXJlSGFuZGxlciIsImNsZWFySW1tZWRpYXRlIiwiaGFuZGxlcklEIiwic2V0TmF0aXZlUHJvcHMiLCJ1cGRhdGVzIiwibWVyZ2VkUHJvcHMiLCJyZW5kZXIiLCJnZXN0dXJlRXZlbnRIYW5kbGVyIiwiZ2VzdHVyZVN0YXRlRXZlbnRIYW5kbGVyIiwiZXZlbnRzIiwiZ3JhbmRDaGlsZHJlbiIsIlRvdWNoYWJsZSIsIlRPVUNIX1RBUkdFVF9ERUJVRyIsInR5cGUiLCJkaXNwbGF5TmFtZSIsInRvQXJyYXkiLCJwdXNoIiwicmVuZGVyRGVidWdWaWV3IiwiY29sb3IiLCJoaXRTbG9wIiwiY2xvbmVFbGVtZW50IiwicmVmSGFuZGxlciIsImNvbGxhcHNhYmxlIiwiQ29tcG9uZW50Il0sInNvdXJjZXMiOlsiY3JlYXRlSGFuZGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQge1xuICBQbGF0Zm9ybSxcbiAgVG91Y2hhYmxlLFxuICBVSU1hbmFnZXIsXG4gIERldmljZUV2ZW50RW1pdHRlcixcbiAgRW1pdHRlclN1YnNjcmlwdGlvbixcbn0gZnJvbSAncmVhY3QtbmF0aXZlJztcbi8vIEB0cy1pZ25vcmUgLSBpdCBpc24ndCB0eXBlZCBieSBUUyAmIGRvbid0IGhhdmUgZGVmaW5pdGVseVR5cGVkIHR5cGVzXG5pbXBvcnQgZGVlcEVxdWFsIGZyb20gJ2xvZGFzaC9pc0VxdWFsJztcbmltcG9ydCBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlIGZyb20gJy4uL1JOR2VzdHVyZUhhbmRsZXJNb2R1bGUnO1xuaW1wb3J0IHR5cGUgUk5HZXN0dXJlSGFuZGxlck1vZHVsZVdlYiBmcm9tICcuLi9STkdlc3R1cmVIYW5kbGVyTW9kdWxlLndlYic7XG5pbXBvcnQgeyBTdGF0ZSB9IGZyb20gJy4uL1N0YXRlJztcbmltcG9ydCB7IGhhbmRsZXJJRFRvVGFnLCBnZXROZXh0SGFuZGxlclRhZyB9IGZyb20gJy4vaGFuZGxlcnNSZWdpc3RyeSc7XG5cbmltcG9ydCB7XG4gIEJhc2VHZXN0dXJlSGFuZGxlclByb3BzLFxuICBmaWx0ZXJDb25maWcsXG4gIEdlc3R1cmVFdmVudCxcbiAgSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQsXG4gIGZpbmROb2RlSGFuZGxlLFxufSBmcm9tICcuL2dlc3R1cmVIYW5kbGVyQ29tbW9uJztcbmltcG9ydCB7IFZhbHVlT2YgfSBmcm9tICcuLi90eXBlVXRpbHMnO1xuXG5jb25zdCBVSU1hbmFnZXJBbnkgPSBVSU1hbmFnZXIgYXMgYW55O1xuXG5jb25zdCBjdXN0b21HSEV2ZW50c0NvbmZpZyA9IHtcbiAgb25HZXN0dXJlSGFuZGxlckV2ZW50OiB7IHJlZ2lzdHJhdGlvbk5hbWU6ICdvbkdlc3R1cmVIYW5kbGVyRXZlbnQnIH0sXG4gIG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZToge1xuICAgIHJlZ2lzdHJhdGlvbk5hbWU6ICdvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UnLFxuICB9LFxufTtcblxuLy8gQWRkIGdlc3R1cmUgc3BlY2lmaWMgZXZlbnRzIHRvIGdlbmVyaWNEaXJlY3RFdmVudFR5cGVzIG9iamVjdCBleHBvcnRlZCBmcm9tIFVJTWFuYWdlclxuLy8gbmF0aXZlIG1vZHVsZS5cbi8vIE9uY2UgbmV3IGV2ZW50IHR5cGVzIGFyZSByZWdpc3RlcmVkIHdpdGggcmVhY3QgaXQgaXMgcG9zc2libGUgdG8gZGlzcGF0Y2ggdGhlc2Vcbi8vIGV2ZW50cyB0byBhbGwga2luZCBvZiBuYXRpdmUgdmlld3MuXG5VSU1hbmFnZXJBbnkuZ2VuZXJpY0RpcmVjdEV2ZW50VHlwZXMgPSB7XG4gIC4uLlVJTWFuYWdlckFueS5nZW5lcmljRGlyZWN0RXZlbnRUeXBlcyxcbiAgLi4uY3VzdG9tR0hFdmVudHNDb25maWcsXG59O1xuLy8gSW4gbmV3ZXIgdmVyc2lvbnMgb2YgUk4gdGhlIGBnZW5lcmljRGlyZWN0RXZlbnRUeXBlc2AgaXMgbG9jYXRlZCBpbiB0aGUgb2JqZWN0XG4vLyByZXR1cm5lZCBieSBVSU1hbmFnZXIuZ2V0Vmlld01hbmFnZXJDb25maWcoJ2dldENvbnN0YW50cycpIG9yIGluIG9sZGVyIFJOIFVJTWFuYWdlci5nZXRDb25zdGFudHMoKSwgd2UgbmVlZCB0byBhZGQgaXQgdGhlcmUgYXMgd2VsbCB0byBtYWtlXG4vLyBpdCBjb21wYXRpYmxlIHdpdGggUk4gNjErXG5jb25zdCBVSU1hbmFnZXJDb25zdGFudHMgPVxuICBVSU1hbmFnZXJBbnkuZ2V0Vmlld01hbmFnZXJDb25maWc/LignZ2V0Q29uc3RhbnRzJykgPz9cbiAgVUlNYW5hZ2VyQW55LmdldENvbnN0YW50cz8uKCk7XG5cbmlmIChVSU1hbmFnZXJDb25zdGFudHMpIHtcbiAgVUlNYW5hZ2VyQ29uc3RhbnRzLmdlbmVyaWNEaXJlY3RFdmVudFR5cGVzID0ge1xuICAgIC4uLlVJTWFuYWdlckNvbnN0YW50cy5nZW5lcmljRGlyZWN0RXZlbnRUeXBlcyxcbiAgICAuLi5jdXN0b21HSEV2ZW50c0NvbmZpZyxcbiAgfTtcbn1cblxuLy8gV3JhcCBKUyByZXNwb25kZXIgY2FsbHMgYW5kIG5vdGlmeSBnZXN0dXJlIGhhbmRsZXIgbWFuYWdlclxuY29uc3Qge1xuICBzZXRKU1Jlc3BvbmRlcjogb2xkU2V0SlNSZXNwb25kZXIgPSAoKSA9PiB7XG4gICAgLy9ubyBvcGVyYXRpb25cbiAgfSxcbiAgY2xlYXJKU1Jlc3BvbmRlcjogb2xkQ2xlYXJKU1Jlc3BvbmRlciA9ICgpID0+IHtcbiAgICAvL25vIG9wZXJhdGlvblxuICB9LFxufSA9IFVJTWFuYWdlckFueTtcblVJTWFuYWdlckFueS5zZXRKU1Jlc3BvbmRlciA9ICh0YWc6IG51bWJlciwgYmxvY2tOYXRpdmVSZXNwb25kZXI6IGJvb2xlYW4pID0+IHtcbiAgUk5HZXN0dXJlSGFuZGxlck1vZHVsZS5oYW5kbGVTZXRKU1Jlc3BvbmRlcih0YWcsIGJsb2NrTmF0aXZlUmVzcG9uZGVyKTtcbiAgb2xkU2V0SlNSZXNwb25kZXIodGFnLCBibG9ja05hdGl2ZVJlc3BvbmRlcik7XG59O1xuVUlNYW5hZ2VyQW55LmNsZWFySlNSZXNwb25kZXIgPSAoKSA9PiB7XG4gIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUuaGFuZGxlQ2xlYXJKU1Jlc3BvbmRlcigpO1xuICBvbGRDbGVhckpTUmVzcG9uZGVyKCk7XG59O1xuXG5sZXQgYWxsb3dUb3VjaGVzID0gdHJ1ZTtcbmNvbnN0IERFVl9PTl9BTkRST0lEID0gX19ERVZfXyAmJiBQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnO1xuLy8gVG9nZ2xlZCBpbnNwZWN0b3IgYmxvY2tzIHRvdWNoIGV2ZW50cyBpbiBvcmRlciB0byBhbGxvdyBpbnNwZWN0aW5nIG9uIEFuZHJvaWRcbi8vIFRoaXMgbmVlZHMgdG8gYmUgYSBnbG9iYWwgdmFyaWFibGUgaW4gb3JkZXIgdG8gc2V0IGluaXRpYWwgc3RhdGUgZm9yIGBhbGxvd1RvdWNoZXNgIHByb3BlcnR5IGluIEhhbmRsZXIgY29tcG9uZW50XG5pZiAoREVWX09OX0FORFJPSUQpIHtcbiAgRGV2aWNlRXZlbnRFbWl0dGVyLmFkZExpc3RlbmVyKCd0b2dnbGVFbGVtZW50SW5zcGVjdG9yJywgKCkgPT4ge1xuICAgIGFsbG93VG91Y2hlcyA9ICFhbGxvd1RvdWNoZXM7XG4gIH0pO1xufVxuXG50eXBlIEhhbmRsZXJQcm9wczxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4+ID0gUmVhZG9ubHk8XG4gIFJlYWN0LlByb3BzV2l0aENoaWxkcmVuPEJhc2VHZXN0dXJlSGFuZGxlclByb3BzPFQ+PlxuPjtcbmZ1bmN0aW9uIGhhc1VucmVzb2x2ZWRSZWZzPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4oXG4gIHByb3BzOiBIYW5kbGVyUHJvcHM8VD5cbikge1xuICAvLyBUT0RPKFRTKSAtIGFkZCB0eXBlIGZvciBleHRyYWN0IGFyZ1xuICBjb25zdCBleHRyYWN0ID0gKHJlZnM6IGFueSB8IGFueVtdKSA9PiB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHJlZnMpKSB7XG4gICAgICByZXR1cm4gcmVmcyAmJiByZWZzLmN1cnJlbnQgPT09IG51bGw7XG4gICAgfVxuICAgIHJldHVybiByZWZzLnNvbWUoKHIpID0+IHIgJiYgci5jdXJyZW50ID09PSBudWxsKTtcbiAgfTtcbiAgcmV0dXJuIGV4dHJhY3QocHJvcHNbJ3NpbXVsdGFuZW91c0hhbmRsZXJzJ10pIHx8IGV4dHJhY3QocHJvcHNbJ3dhaXRGb3InXSk7XG59XG5cbmNvbnN0IHN0YXRlVG9Qcm9wTWFwcGluZ3MgPSB7XG4gIFtTdGF0ZS5VTkRFVEVSTUlORURdOiB1bmRlZmluZWQsXG4gIFtTdGF0ZS5CRUdBTl06ICdvbkJlZ2FuJyxcbiAgW1N0YXRlLkZBSUxFRF06ICdvbkZhaWxlZCcsXG4gIFtTdGF0ZS5DQU5DRUxMRURdOiAnb25DYW5jZWxsZWQnLFxuICBbU3RhdGUuQUNUSVZFXTogJ29uQWN0aXZhdGVkJyxcbiAgW1N0YXRlLkVORF06ICdvbkVuZGVkJyxcbn0gYXMgY29uc3Q7XG5cbnR5cGUgQ3JlYXRlSGFuZGxlckFyZ3M8XG4gIEhhbmRsZXJQcm9wc1QgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPiA9IFJlYWRvbmx5PHtcbiAgbmFtZTogc3RyaW5nO1xuICBhbGxvd2VkUHJvcHM6IFJlYWRvbmx5PEV4dHJhY3Q8a2V5b2YgSGFuZGxlclByb3BzVCwgc3RyaW5nPltdPjtcbiAgY29uZmlnOiBSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj47XG4gIHRyYW5zZm9ybVByb3BzPzogKHByb3BzOiBIYW5kbGVyUHJvcHNUKSA9PiBIYW5kbGVyUHJvcHNUO1xuICBjdXN0b21OYXRpdmVQcm9wcz86IFJlYWRvbmx5PHN0cmluZ1tdPjtcbn0+O1xuXG4vLyBUT0RPKFRTKSBmaXggZXZlbnQgdHlwZXNcbnR5cGUgSW50ZXJuYWxFdmVudEhhbmRsZXJzID0ge1xuICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQ/OiAoZXZlbnQ6IGFueSkgPT4gdm9pZDtcbiAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlPzogKGV2ZW50OiBhbnkpID0+IHZvaWQ7XG59O1xuXG4vLyBUT0RPKFRTKSAtIG1ha2Ugc3VyZSB0aGF0IEJhc2VHZXN0dXJlSGFuZGxlclByb3BzIGRvZXNuJ3QgbmVlZCBvdGhlciBnZW5lcmljIHBhcmFtZXRlciB0byB3b3JrIHdpdGggY3VzdG9tIHByb3BlcnRpZXMuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVIYW5kbGVyPFxuICBUIGV4dGVuZHMgQmFzZUdlc3R1cmVIYW5kbGVyUHJvcHM8VT4sXG4gIFUgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPih7XG4gIG5hbWUsXG4gIGFsbG93ZWRQcm9wcyA9IFtdLFxuICBjb25maWcgPSB7fSxcbiAgdHJhbnNmb3JtUHJvcHMsXG4gIGN1c3RvbU5hdGl2ZVByb3BzID0gW10sXG59OiBDcmVhdGVIYW5kbGVyQXJnczxUPik6IFJlYWN0LkNvbXBvbmVudFR5cGU8VCAmIFJlYWN0LlJlZkF0dHJpYnV0ZXM8YW55Pj4ge1xuICBpbnRlcmZhY2UgSGFuZGxlclN0YXRlIHtcbiAgICBhbGxvd1RvdWNoZXM6IGJvb2xlYW47XG4gIH1cbiAgY2xhc3MgSGFuZGxlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxcbiAgICBUICYgSW50ZXJuYWxFdmVudEhhbmRsZXJzLFxuICAgIEhhbmRsZXJTdGF0ZVxuICA+IHtcbiAgICBzdGF0aWMgZGlzcGxheU5hbWUgPSBuYW1lO1xuXG4gICAgcHJpdmF0ZSBoYW5kbGVyVGFnOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBjb25maWc6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIHByaXZhdGUgcHJvcHNSZWY6IFJlYWN0Lk11dGFibGVSZWZPYmplY3Q8dW5rbm93bj47XG4gICAgcHJpdmF0ZSB2aWV3Tm9kZTogYW55O1xuICAgIHByaXZhdGUgdmlld1RhZz86IG51bWJlcjtcbiAgICBwcml2YXRlIHVwZGF0ZUVucXVldWVkOiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRJbW1lZGlhdGU+IHwgbnVsbCA9IG51bGw7XG4gICAgcHJpdmF0ZSBpbnNwZWN0b3JUb2dnbGVMaXN0ZW5lcj86IEVtaXR0ZXJTdWJzY3JpcHRpb247XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogVCAmIEludGVybmFsRXZlbnRIYW5kbGVycykge1xuICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgdGhpcy5oYW5kbGVyVGFnID0gZ2V0TmV4dEhhbmRsZXJUYWcoKTtcbiAgICAgIHRoaXMuY29uZmlnID0ge307XG4gICAgICB0aGlzLnByb3BzUmVmID0gUmVhY3QuY3JlYXRlUmVmKCk7XG4gICAgICB0aGlzLnN0YXRlID0geyBhbGxvd1RvdWNoZXMgfTtcbiAgICAgIGlmIChwcm9wcy5pZCkge1xuICAgICAgICBpZiAoaGFuZGxlcklEVG9UYWdbcHJvcHMuaWRdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhhbmRsZXIgd2l0aCBJRCBcIiR7cHJvcHMuaWR9XCIgYWxyZWFkeSByZWdpc3RlcmVkYCk7XG4gICAgICAgIH1cbiAgICAgICAgaGFuZGxlcklEVG9UYWdbcHJvcHMuaWRdID0gdGhpcy5oYW5kbGVyVGFnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgY29uc3QgcHJvcHM6IEhhbmRsZXJQcm9wczxVPiA9IHRoaXMucHJvcHM7XG5cbiAgICAgIGlmIChERVZfT05fQU5EUk9JRCkge1xuICAgICAgICB0aGlzLmluc3BlY3RvclRvZ2dsZUxpc3RlbmVyID0gRGV2aWNlRXZlbnRFbWl0dGVyLmFkZExpc3RlbmVyKFxuICAgICAgICAgICd0b2dnbGVFbGVtZW50SW5zcGVjdG9yJyxcbiAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKChfKSA9PiAoeyBhbGxvd1RvdWNoZXMgfSkpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoaGFzVW5yZXNvbHZlZFJlZnMocHJvcHMpKSB7XG4gICAgICAgIC8vIElmIHRoZXJlIGFyZSB1bnJlc29sdmVkIHJlZnMgKGUuZy4gXCIuY3VycmVudFwiIGhhcyBub3QgeWV0IGJlZW4gc2V0KVxuICAgICAgICAvLyBwYXNzZWQgYXMgYHNpbXVsdGFuZW91c0hhbmRsZXJzYCBvciBgd2FpdEZvcmAsIHdlIGVucXVldWUgYSBjYWxsIHRvXG4gICAgICAgIC8vIF91cGRhdGUgbWV0aG9kIHRoYXQgd2lsbCB0cnkgdG8gdXBkYXRlIG5hdGl2ZSBoYW5kbGVyIHByb3BzIHVzaW5nXG4gICAgICAgIC8vIHNldEltbWVkaWF0ZS4gVGhpcyBtYWtlcyBpdCBzbyB1cGRhdGUoKSBmdW5jdGlvbiBnZXRzIGNhbGxlZCBhZnRlciBhbGxcbiAgICAgICAgLy8gcmVhY3QgY29tcG9uZW50cyBhcmUgbW91bnRlZCBhbmQgd2UgZXhwZWN0IHRoZSBtaXNzaW5nIHJlZiBvYmplY3QgdG9cbiAgICAgICAgLy8gYmUgcmVzb2x2ZWQgYnkgdGhlbi5cbiAgICAgICAgdGhpcy51cGRhdGVFbnF1ZXVlZCA9IHNldEltbWVkaWF0ZSgoKSA9PiB7XG4gICAgICAgICAgdGhpcy51cGRhdGVFbnF1ZXVlZCA9IG51bGw7XG4gICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY3JlYXRlR2VzdHVyZUhhbmRsZXIoXG4gICAgICAgIGZpbHRlckNvbmZpZyhcbiAgICAgICAgICB0cmFuc2Zvcm1Qcm9wcyA/IHRyYW5zZm9ybVByb3BzKHRoaXMucHJvcHMpIDogdGhpcy5wcm9wcyxcbiAgICAgICAgICBbLi4uYWxsb3dlZFByb3BzLCAuLi5jdXN0b21OYXRpdmVQcm9wc10sXG4gICAgICAgICAgY29uZmlnXG4gICAgICAgIClcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuYXR0YWNoR2VzdHVyZUhhbmRsZXIoZmluZE5vZGVIYW5kbGUodGhpcy52aWV3Tm9kZSkgYXMgbnVtYmVyKTsgLy8gVE9ETyhUUykgLSBjaGVjayBpZiB0aGlzIGNhbiBiZSBudWxsXG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgICAgY29uc3Qgdmlld1RhZyA9IGZpbmROb2RlSGFuZGxlKHRoaXMudmlld05vZGUpO1xuICAgICAgaWYgKHRoaXMudmlld1RhZyAhPT0gdmlld1RhZykge1xuICAgICAgICB0aGlzLmF0dGFjaEdlc3R1cmVIYW5kbGVyKHZpZXdUYWcgYXMgbnVtYmVyKTsgLy8gVE9ETyhUUykgLSBjaGVjayBpbnRlcmFjdGlvbiBiZXR3ZWVuIF92aWV3VGFnICYgZmluZE5vZGVIYW5kbGVcbiAgICAgIH1cbiAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICB0aGlzLmluc3BlY3RvclRvZ2dsZUxpc3RlbmVyPy5yZW1vdmUoKTtcbiAgICAgIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUuZHJvcEdlc3R1cmVIYW5kbGVyKHRoaXMuaGFuZGxlclRhZyk7XG4gICAgICBpZiAodGhpcy51cGRhdGVFbnF1ZXVlZCkge1xuICAgICAgICBjbGVhckltbWVkaWF0ZSh0aGlzLnVwZGF0ZUVucXVldWVkKTtcbiAgICAgIH1cbiAgICAgIC8vIFdlIGNhbid0IHVzZSB0aGlzLnByb3BzLmlkIGRpcmVjdGx5IGR1ZSB0byBUUyBnZW5lcmljIHR5cGUgbmFycm93aW5nIGJ1Zywgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTM5OTUgZm9yIG1vcmUgY29udGV4dFxuICAgICAgY29uc3QgaGFuZGxlcklEOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLnByb3BzLmlkO1xuICAgICAgaWYgKGhhbmRsZXJJRCkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWR5bmFtaWMtZGVsZXRlXG4gICAgICAgIGRlbGV0ZSBoYW5kbGVySURUb1RhZ1toYW5kbGVySURdO1xuICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgb25HZXN0dXJlSGFuZGxlckV2ZW50ID0gKGV2ZW50OiBHZXN0dXJlRXZlbnQ8VT4pID0+IHtcbiAgICAgIGlmIChldmVudC5uYXRpdmVFdmVudC5oYW5kbGVyVGFnID09PSB0aGlzLmhhbmRsZXJUYWcpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkdlc3R1cmVFdmVudD8uKGV2ZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucHJvcHMub25HZXN0dXJlSGFuZGxlckV2ZW50Py4oZXZlbnQpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBUT0RPKFRTKSAtIG1ha2Ugc3VyZSB0aGlzIGlzIHJpZ2h0IHR5cGUgZm9yIGV2ZW50XG4gICAgcHJpdmF0ZSBvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UgPSAoXG4gICAgICBldmVudDogSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQ8VT5cbiAgICApID0+IHtcbiAgICAgIGlmIChldmVudC5uYXRpdmVFdmVudC5oYW5kbGVyVGFnID09PSB0aGlzLmhhbmRsZXJUYWcpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkhhbmRsZXJTdGF0ZUNoYW5nZT8uKGV2ZW50KTtcblxuICAgICAgICBjb25zdCBzdGF0ZTogVmFsdWVPZjx0eXBlb2YgU3RhdGU+ID0gZXZlbnQubmF0aXZlRXZlbnQuc3RhdGU7XG4gICAgICAgIGNvbnN0IHN0YXRlRXZlbnROYW1lID0gc3RhdGVUb1Byb3BNYXBwaW5nc1tzdGF0ZV07XG4gICAgICAgIGNvbnN0IGV2ZW50SGFuZGxlciA9IHN0YXRlRXZlbnROYW1lICYmIHRoaXMucHJvcHNbc3RhdGVFdmVudE5hbWVdO1xuICAgICAgICBpZiAoZXZlbnRIYW5kbGVyICYmIHR5cGVvZiBldmVudEhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBldmVudEhhbmRsZXIoZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnByb3BzLm9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZT8uKGV2ZW50KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSByZWZIYW5kbGVyID0gKG5vZGU6IGFueSkgPT4ge1xuICAgICAgdGhpcy52aWV3Tm9kZSA9IG5vZGU7XG5cbiAgICAgIGNvbnN0IGNoaWxkID0gUmVhY3QuQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKTtcbiAgICAgIC8vIFRPRE8oVFMpIGZpeCByZWYgdHlwZVxuICAgICAgY29uc3QgeyByZWYgfTogYW55ID0gY2hpbGQ7XG4gICAgICBpZiAocmVmICE9PSBudWxsKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcmVmID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgcmVmKG5vZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlZi5jdXJyZW50ID0gbm9kZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIGNyZWF0ZUdlc3R1cmVIYW5kbGVyID0gKFxuICAgICAgbmV3Q29uZmlnOiBSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj5cbiAgICApID0+IHtcbiAgICAgIHRoaXMuY29uZmlnID0gbmV3Q29uZmlnO1xuXG4gICAgICBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmNyZWF0ZUdlc3R1cmVIYW5kbGVyKFxuICAgICAgICBuYW1lLFxuICAgICAgICB0aGlzLmhhbmRsZXJUYWcsXG4gICAgICAgIG5ld0NvbmZpZ1xuICAgICAgKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBhdHRhY2hHZXN0dXJlSGFuZGxlciA9IChuZXdWaWV3VGFnOiBudW1iZXIpID0+IHtcbiAgICAgIHRoaXMudmlld1RhZyA9IG5ld1ZpZXdUYWc7XG5cbiAgICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicpIHtcbiAgICAgICAgLy8gdHlwZWNhc3QgZHVlIHRvIGR5bmFtaWMgcmVzb2x1dGlvbiwgYXR0YWNoR2VzdHVyZUhhbmRsZXIgc2hvdWxkIGhhdmUgd2ViIHZlcnNpb24gc2lnbmF0dXJlIGluIHRoaXMgYnJhbmNoXG4gICAgICAgIChSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmF0dGFjaEdlc3R1cmVIYW5kbGVyIGFzIHR5cGVvZiBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlV2ViLmF0dGFjaEdlc3R1cmVIYW5kbGVyKShcbiAgICAgICAgICB0aGlzLmhhbmRsZXJUYWcsXG4gICAgICAgICAgbmV3Vmlld1RhZyxcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICB0aGlzLnByb3BzUmVmXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmF0dGFjaEdlc3R1cmVIYW5kbGVyKFxuICAgICAgICAgIHRoaXMuaGFuZGxlclRhZyxcbiAgICAgICAgICBuZXdWaWV3VGFnLFxuICAgICAgICAgIGZhbHNlXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgdXBkYXRlR2VzdHVyZUhhbmRsZXIgPSAoXG4gICAgICBuZXdDb25maWc6IFJlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PlxuICAgICkgPT4ge1xuICAgICAgdGhpcy5jb25maWcgPSBuZXdDb25maWc7XG5cbiAgICAgIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUudXBkYXRlR2VzdHVyZUhhbmRsZXIodGhpcy5oYW5kbGVyVGFnLCBuZXdDb25maWcpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHVwZGF0ZSgpIHtcbiAgICAgIGNvbnN0IG5ld0NvbmZpZyA9IGZpbHRlckNvbmZpZyhcbiAgICAgICAgdHJhbnNmb3JtUHJvcHMgPyB0cmFuc2Zvcm1Qcm9wcyh0aGlzLnByb3BzKSA6IHRoaXMucHJvcHMsXG4gICAgICAgIFsuLi5hbGxvd2VkUHJvcHMsIC4uLmN1c3RvbU5hdGl2ZVByb3BzXSxcbiAgICAgICAgY29uZmlnXG4gICAgICApO1xuICAgICAgaWYgKCFkZWVwRXF1YWwodGhpcy5jb25maWcsIG5ld0NvbmZpZykpIHtcbiAgICAgICAgdGhpcy51cGRhdGVHZXN0dXJlSGFuZGxlcihuZXdDb25maWcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHNldE5hdGl2ZVByb3BzKHVwZGF0ZXM6IGFueSkge1xuICAgICAgY29uc3QgbWVyZ2VkUHJvcHMgPSB7IC4uLnRoaXMucHJvcHMsIC4uLnVwZGF0ZXMgfTtcbiAgICAgIGNvbnN0IG5ld0NvbmZpZyA9IGZpbHRlckNvbmZpZyhcbiAgICAgICAgdHJhbnNmb3JtUHJvcHMgPyB0cmFuc2Zvcm1Qcm9wcyhtZXJnZWRQcm9wcykgOiBtZXJnZWRQcm9wcyxcbiAgICAgICAgWy4uLmFsbG93ZWRQcm9wcywgLi4uY3VzdG9tTmF0aXZlUHJvcHNdLFxuICAgICAgICBjb25maWdcbiAgICAgICk7XG4gICAgICB0aGlzLnVwZGF0ZUdlc3R1cmVIYW5kbGVyKG5ld0NvbmZpZyk7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgbGV0IGdlc3R1cmVFdmVudEhhbmRsZXIgPSB0aGlzLm9uR2VzdHVyZUhhbmRsZXJFdmVudDtcbiAgICAgIC8vIEFub3RoZXIgaW5zdGFuY2Ugb2YgaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy8xMzk5NVxuICAgICAgdHlwZSBPbkdlc3R1cmVFdmVudEhhbmRsZXJzID0ge1xuICAgICAgICBvbkdlc3R1cmVFdmVudD86IEJhc2VHZXN0dXJlSGFuZGxlclByb3BzPFU+Wydvbkdlc3R1cmVFdmVudCddO1xuICAgICAgICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQ/OiBJbnRlcm5hbEV2ZW50SGFuZGxlcnNbJ29uR2VzdHVyZUhhbmRsZXJFdmVudCddO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgb25HZXN0dXJlRXZlbnQsXG4gICAgICAgIG9uR2VzdHVyZUhhbmRsZXJFdmVudCxcbiAgICAgIH06IE9uR2VzdHVyZUV2ZW50SGFuZGxlcnMgPSB0aGlzLnByb3BzO1xuICAgICAgaWYgKG9uR2VzdHVyZUV2ZW50ICYmIHR5cGVvZiBvbkdlc3R1cmVFdmVudCAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAvLyBJZiBpdCdzIG5vdCBhIG1ldGhvZCBpdCBzaG91bGQgYmUgYW4gbmF0aXZlIEFuaW1hdGVkLmV2ZW50XG4gICAgICAgIC8vIG9iamVjdC4gV2Ugc2V0IGl0IGRpcmVjdGx5IGFzIHRoZSBoYW5kbGVyIGZvciB0aGUgdmlld1xuICAgICAgICAvLyBJbiB0aGlzIGNhc2UgbmVzdGVkIGhhbmRsZXJzIGFyZSBub3QgZ29pbmcgdG8gYmUgc3VwcG9ydGVkXG4gICAgICAgIGlmIChvbkdlc3R1cmVIYW5kbGVyRXZlbnQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBnZXN0dXJlRXZlbnRIYW5kbGVyID0gb25HZXN0dXJlRXZlbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb25HZXN0dXJlSGFuZGxlckV2ZW50ICYmXG4gICAgICAgICAgdHlwZW9mIG9uR2VzdHVyZUhhbmRsZXJFdmVudCAhPT0gJ2Z1bmN0aW9uJ1xuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsZXQgZ2VzdHVyZVN0YXRlRXZlbnRIYW5kbGVyID0gdGhpcy5vbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2U7XG4gICAgICAvLyBBbm90aGVyIGluc3RhbmNlIG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTM5OTVcbiAgICAgIHR5cGUgT25HZXN0dXJlU3RhdGVDaGFuZ2VIYW5kbGVycyA9IHtcbiAgICAgICAgb25IYW5kbGVyU3RhdGVDaGFuZ2U/OiBCYXNlR2VzdHVyZUhhbmRsZXJQcm9wczxVPlsnb25IYW5kbGVyU3RhdGVDaGFuZ2UnXTtcbiAgICAgICAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlPzogSW50ZXJuYWxFdmVudEhhbmRsZXJzWydvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UnXTtcbiAgICAgIH07XG4gICAgICBjb25zdCB7XG4gICAgICAgIG9uSGFuZGxlclN0YXRlQ2hhbmdlLFxuICAgICAgICBvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UsXG4gICAgICB9OiBPbkdlc3R1cmVTdGF0ZUNoYW5nZUhhbmRsZXJzID0gdGhpcy5wcm9wcztcbiAgICAgIGlmIChvbkhhbmRsZXJTdGF0ZUNoYW5nZSAmJiB0eXBlb2Ygb25IYW5kbGVyU3RhdGVDaGFuZ2UgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgLy8gSWYgaXQncyBub3QgYSBtZXRob2QgaXQgc2hvdWxkIGJlIGFuIG5hdGl2ZSBBbmltYXRlZC5ldmVudFxuICAgICAgICAvLyBvYmplY3QuIFdlIHNldCBpdCBkaXJlY3RseSBhcyB0aGUgaGFuZGxlciBmb3IgdGhlIHZpZXdcbiAgICAgICAgLy8gSW4gdGhpcyBjYXNlIG5lc3RlZCBoYW5kbGVycyBhcmUgbm90IGdvaW5nIHRvIGJlIHN1cHBvcnRlZFxuICAgICAgICBpZiAob25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgJ05lc3RpbmcgdG91Y2ggaGFuZGxlcnMgd2l0aCBuYXRpdmUgYW5pbWF0ZWQgZHJpdmVyIGlzIG5vdCBzdXBwb3J0ZWQgeWV0J1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgZ2VzdHVyZVN0YXRlRXZlbnRIYW5kbGVyID0gb25IYW5kbGVyU3RhdGVDaGFuZ2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlICYmXG4gICAgICAgICAgdHlwZW9mIG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZSAhPT0gJ2Z1bmN0aW9uJ1xuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3QgZXZlbnRzID0ge1xuICAgICAgICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQ6IHRoaXMuc3RhdGUuYWxsb3dUb3VjaGVzXG4gICAgICAgICAgPyBnZXN0dXJlRXZlbnRIYW5kbGVyXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgIG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZTogdGhpcy5zdGF0ZS5hbGxvd1RvdWNoZXNcbiAgICAgICAgICA/IGdlc3R1cmVTdGF0ZUV2ZW50SGFuZGxlclxuICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgfTtcblxuICAgICAgdGhpcy5wcm9wc1JlZi5jdXJyZW50ID0gZXZlbnRzO1xuXG4gICAgICBjb25zdCBjaGlsZDogYW55ID0gUmVhY3QuQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKTtcbiAgICAgIGxldCBncmFuZENoaWxkcmVuID0gY2hpbGQucHJvcHMuY2hpbGRyZW47XG4gICAgICBpZiAoXG4gICAgICAgIFRvdWNoYWJsZS5UT1VDSF9UQVJHRVRfREVCVUcgJiZcbiAgICAgICAgY2hpbGQudHlwZSAmJlxuICAgICAgICAoY2hpbGQudHlwZSA9PT0gJ1JOR2VzdHVyZUhhbmRsZXJCdXR0b24nIHx8XG4gICAgICAgICAgY2hpbGQudHlwZS5uYW1lID09PSAnVmlldycgfHxcbiAgICAgICAgICBjaGlsZC50eXBlLmRpc3BsYXlOYW1lID09PSAnVmlldycpXG4gICAgICApIHtcbiAgICAgICAgZ3JhbmRDaGlsZHJlbiA9IFJlYWN0LkNoaWxkcmVuLnRvQXJyYXkoZ3JhbmRDaGlsZHJlbik7XG4gICAgICAgIGdyYW5kQ2hpbGRyZW4ucHVzaChcbiAgICAgICAgICBUb3VjaGFibGUucmVuZGVyRGVidWdWaWV3KHtcbiAgICAgICAgICAgIGNvbG9yOiAnbWVkaXVtc3ByaW5nZ3JlZW4nLFxuICAgICAgICAgICAgaGl0U2xvcDogY2hpbGQucHJvcHMuaGl0U2xvcCxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KFxuICAgICAgICBjaGlsZCxcbiAgICAgICAge1xuICAgICAgICAgIHJlZjogdGhpcy5yZWZIYW5kbGVyLFxuICAgICAgICAgIGNvbGxhcHNhYmxlOiBmYWxzZSxcbiAgICAgICAgICAuLi5ldmVudHMsXG4gICAgICAgIH0sXG4gICAgICAgIGdyYW5kQ2hpbGRyZW5cbiAgICAgICk7XG4gICAgfVxuICB9XG4gIHJldHVybiBIYW5kbGVyO1xufVxuIl19