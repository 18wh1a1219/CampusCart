{"version":3,"names":["Messages","navigation","users","setUsers","chat","setChat","text","setText","isFocused","img","setImg","msgs","setMsgs","msg","setMsg","usersList","setUsersList","scrollRef","userMsgsInfo","setUserMsgsInfo","screenWidth","Dimensions","get","width","user1","firebase","auth","currentUser","uid","db","firestore","fetch","collection","then","snapshot","userr","docs","map","doc","data","msgsInfo","mappedObj","u","console","log","count","forEach","user","len","length","user2","id","unread","orderBy","onSnapshot","querySnapshot","from","read","push","res","find","userData","styles","Container","card_template","button2","navigate","paramKey","fullName","buttonText","height","StyleSheet","create","contentContainer","marginTop","paddingVertical","backgroundColor","alignItems","name","top","fontWeight","alignSelf","color","sender","left","padding","borderWidth","margin","borderColor","receiver","textInput","fontSize","alignContent","flexDirection","justifyContent","b","borderRadius"],"sources":["Messages.js"],"sourcesContent":["import React, { useState, useCallback, useLayoutEffect, useRef, useEffect } from 'react';\r\n\r\nimport { GiftedChat } from 'react-native-gifted-chat'\r\nimport * as firebase from 'firebase';\r\nimport {\r\n  collection,\r\n  query,\r\n  where,\r\n  onSnapshot,\r\n  addDoc,\r\n  Timestamp,\r\n  orderBy,\r\n  setDoc,\r\n  doc,\r\n  getDoc,\r\n  updateDoc,\r\n} from \"firebase/firestore\";\r\nimport { useIsFocused } from '@react-navigation/native';\r\n\r\nimport { View, Text, StyleSheet, Image, Button } from 'react-native';\r\nimport { TextInput, Alert, ScrollView,Dimensions, Keyboard, SafeAreaView } from 'react-native';\r\nimport { TouchableOpacity } from 'react-native-gesture-handler';\r\n\r\nexport default function Messages({ navigation }) {\r\n  const [users, setUsers] = useState([]);\r\n  const [chat, setChat] = useState(\"\");\r\n  const [text, setText] = useState(\"\");\r\n  const isFocused = useIsFocused();\r\n  const [img, setImg] = useState(\"\");\r\n  const [msgs, setMsgs] = useState([]);\r\n  const [msg, setMsg] = useState(\"\");\r\n  const [usersList, setUsersList] = useState([]);\r\n  const scrollRef = useRef();\r\n  const [userMsgsInfo, setUserMsgsInfo] = useState([]);\r\n  var screenWidth = Dimensions.get('window').width;\r\n  const user1 = firebase.auth().currentUser.uid;\r\n  const db = firebase.firestore();\r\n\r\n  useEffect(() => {\r\n    function fetch(){\r\n      firebase.firestore()\r\n          .collection('users')\r\n          .get()\r\n          .then((snapshot) => {\r\n              let userr = snapshot.docs.map(doc => {\r\n                  const data = doc.data();\r\n                  return { ...data }\r\n              })              \r\n              setUsers(userr);\r\n              let msgsInfo = [];\r\n              let mappedObj = {};\r\n              let u = []\r\n              console.log(\"users\",userr)\r\n              var count = 0\r\n              userr.forEach(user => {\r\n                const len = userr.length\r\n                const user2 = user.uid;\r\n                const id = user1 > user2 ? user1 + user2 : user2 + user1;\r\n                let msgs = [];\r\n                let unread = 0;\r\n                firebase.firestore().collection(\"messages\").doc(id).collection(\"chat\").orderBy(\"createdAt\", \"asc\").onSnapshot((querySnapshot) => {\r\n                  querySnapshot.forEach((doc) => {\r\n                    if(doc.data().from === user2 && doc.data().read === false){\r\n                      unread = unread + 1\r\n                    }\r\n                    msgs.push(doc.data());\r\n                  });\r\n                if(msgs.length > 0){\r\n                  let res = userr.find(userData => userData.uid === user2)\r\n                  res.unread = unread\r\n                  u.push(res)\r\n                }\r\n                count = count + 1\r\n                if(count === len){\r\n                  console.log(u)\r\n                  setUsersList(u)\r\n                }\r\n              })\r\n          })\r\n      })\r\n  }     \r\n            \r\n  isFocused &&  fetch();\r\n  }, [isFocused]);\r\n\r\n\r\n  return (\r\n    <View style={styles.Container}>\r\n      <View style={styles.card_template}>\r\n             {usersList.map(user => (\r\n              <View>\r\n              <TouchableOpacity style={styles.button2} onPress={() => navigation.navigate('Chat', { paramKey: user.fullName})}>\r\n                <Text style={styles.buttonText} >{user.fullName} {user.unread}</Text>\r\n              </TouchableOpacity>\r\n              <View style={{height:'2%'}}><Text></Text></View>\r\n              </View>\r\n            ))}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  contentContainer: {\r\n    marginTop: -170,\r\n    paddingVertical: 20,\r\n    backgroundColor: '#F5FCFF',\r\n  },\r\n  Container: {\r\n    height:'100%',\r\n    alignItems: 'center', \r\n  },\r\n  name: {\r\n    top: '2%',\r\n    fontWeight:'bold',\r\n    alignSelf: 'center',\r\n    color:'darkblue'\r\n  },\r\n  sender: {\r\n    left: '83%',\r\n    padding: '4%',\r\n    borderWidth: 2,\r\n    margin:'2%',\r\n    borderColor:'gray'\r\n  },\r\n  receiver: {\r\n    left: '3%',\r\n    padding: '4%',\r\n    borderWidth: 2,\r\n    margin:'2%'\r\n  },\r\n  textInput: {\r\n    width: 300,\r\n    fontSize: 18,\r\n    borderWidth: 2,\r\n    borderColor: 'gray',\r\n    padding: 10,\r\n    margin: 5,\r\n    backgroundColor: '#ffffff'\r\n  },\r\n  card_template: {\r\n    margin:'5%',\r\n    width:'80%',\r\n    alignContent:'center',\r\n    flexDirection:'column',justifyContent:'space-between'\r\n  },\r\n  b: {\r\n    marginTop: '160%'\r\n  },\r\n  button2: {  \r\n    height:50,   \r\n    borderRadius: 15,\r\n    borderWidth: 3,\r\n    borderColor: '#ffd60a',\r\n    backgroundColor: '#ffd60a',\r\n    padding: 9,   \r\n  },\r\n})"],"mappings":"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"}